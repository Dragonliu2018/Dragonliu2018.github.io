{"meta":{"title":"Hexo","subtitle":"","description":"","author":"John Doe","url":"https://dragonliu2018.github.io","root":"/"},"pages":[{"title":"çœ‹æ¿","date":"2025-09-25T15:50:35.151Z","updated":"2025-09-13T14:32:57.212Z","comments":false,"path":"about/index.html","permalink":"https://dragonliu2018.github.io/about/index.html","excerpt":"","text":"è”ç³»æ–¹å¼ï¼šdragonliu2018@gmail.com 1 åˆ†ç±» CTF Web Pwn Reverse Crypto Misc WP æ¶æ„ä»£ç  ç¯å¢ƒä¸å·¥å…· ç½‘ç»œå®‰å…¨ æ¼æ´ å®‰å…¨é˜…è¯» é¢è¯•"},{"title":"åˆ†ç±»","date":"2025-09-25T15:50:35.160Z","updated":"2025-09-13T14:32:57.214Z","comments":false,"path":"categories/index.html","permalink":"https://dragonliu2018.github.io/categories/index.html","excerpt":"","text":""},{"title":"å…‰å½±æµå¹´","date":"2019-09-13T08:56:36.000Z","updated":"2025-09-13T14:32:57.216Z","comments":true,"path":"gallery/index.html","permalink":"https://dragonliu2018.github.io/gallery/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2019-09-13T08:58:45.000Z","updated":"2025-09-13T14:32:57.218Z","comments":true,"path":"link/index.html","permalink":"https://dragonliu2018.github.io/link/index.html","excerpt":"","text":""},{"title":"é‚£äº›å¹´ï¼Œå¬è¿‡çš„éŸ³ä¹","date":"2025-09-25T15:50:35.178Z","updated":"2025-09-13T14:32:57.220Z","comments":true,"path":"music/index.html","permalink":"https://dragonliu2018.github.io/music/index.html","excerpt":"","text":"&#123;% meting &quot;7429975963&quot; &quot;tencent&quot; &quot;playlist&quot; %&#125;&#123;% douban music 30121600 %&#125;"},{"title":"å¯¼èˆª","date":"2025-09-25T15:50:35.224Z","updated":"2025-09-24T16:04:17.872Z","comments":false,"path":"navigation/index.html","permalink":"https://dragonliu2018.github.io/navigation/index.html","excerpt":"","text":"DB doris 1 2 databend 1 2 Tool Hexo 1 2 å¼€æº é¡¹ç›®1 1 2"},{"title":"Repositories","date":"2025-09-25T15:50:35.187Z","updated":"2025-09-13T14:32:57.222Z","comments":false,"path":"repository/index.html","permalink":"https://dragonliu2018.github.io/repository/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2025-09-25T15:50:35.187Z","updated":"2025-09-13T14:32:57.223Z","comments":false,"path":"tags/index.html","permalink":"https://dragonliu2018.github.io/tags/index.html","excerpt":"","text":""},{"title":"ä¸»é¢˜æ›´æ–°æ—¥å¿—","date":"2019-09-13T08:58:45.000Z","updated":"2025-09-13T14:32:57.225Z","comments":true,"path":"theme/index.html","permalink":"https://dragonliu2018.github.io/theme/index.html","excerpt":"","text":"æœ¬ç«™å½“å‰ä¸»é¢˜ä½¿ç”¨çš„æ˜¯Hexo Butterfly TODO åšå®¢ç›¸å†Œé¡µé¢ 2021 å¹´ 02 æœˆ 2æœˆ23æ—¥ï¼š æ·»åŠ èœå•-ä¸»é¢˜ æ›´æ”¹é¦–é¡µå›¾ç‰‡ï¼šç‚¹å‡»æŸ¥çœ‹ 2æœˆ26æ—¥ è§£å†³åšå®¢åŠ å¯†æ–‡ç« æœ¬åœ°æµ‹è¯•é€šè¿‡ï¼Œæäº¤åˆ°GitHubåæœªé€šè¿‡é—®é¢˜ï¼Œè®¿é—® https://dragonliu.tk å³å¯ã€‚å‚è€ƒï¼šhexo-blog-encrypt åœ¨ http ç¯å¢ƒä¸‹æ— æ³•ä½¿ç”¨çš„åŸå› åˆ†æ æ–‡ç« åŠ å¯†éƒ¨åˆ†ä½¿ç”¨ sweetalert æ¥ç¾åŒ–é”™è¯¯æç¤ºã€‚å‚è€ƒ"}],"posts":[{"title":"[DB][doris] å˜é‡é…ç½®æ±‡æ€»","slug":"DB-doris-å˜é‡é…ç½®æ±‡æ€»","date":"2025-09-26T15:36:51.000Z","updated":"2025-09-26T15:40:01.442Z","comments":true,"path":"2025/09/26/DB-doris-å˜é‡é…ç½®æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/26/DB-doris-%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%B1%87%E6%80%BB/","excerpt":"","text":"variables æŸ¥çœ‹å˜é‡ show variables like &quot;%nereids%&quot;; è®¾ç½®å˜é‡ SET enable_nereids_planner=false; -- æ˜¯å¦å¼€å¯æ–°ä¼˜åŒ–å™¨ nereids FE config æŸ¥çœ‹é…ç½® è®¾ç½®é…ç½® BE config æŸ¥çœ‹é…ç½® è®¾ç½®é…ç½®","categories":[{"name":"DB","slug":"DB","permalink":"https://dragonliu2018.github.io/categories/DB/"},{"name":"doris","slug":"DB/doris","permalink":"https://dragonliu2018.github.io/categories/DB/doris/"}],"tags":[]},{"title":"[DB][doris] ç¼–è¯‘æ•™ç¨‹","slug":"DB-doris-ç¼–è¯‘æ•™ç¨‹","date":"2025-09-26T01:09:20.000Z","updated":"2025-09-26T01:10:31.884Z","comments":true,"path":"2025/09/26/DB-doris-ç¼–è¯‘æ•™ç¨‹/","permalink":"https://dragonliu2018.github.io/2025/09/26/DB-doris-%E7%BC%96%E8%AF%91%E6%95%99%E7%A8%8B/","excerpt":"","text":"","categories":[{"name":"DB","slug":"DB","permalink":"https://dragonliu2018.github.io/categories/DB/"},{"name":"doris","slug":"DB/doris","permalink":"https://dragonliu2018.github.io/categories/DB/doris/"}],"tags":[]},{"title":"[DB][doris] ç¼–è¯‘æŠ¥é”™æ±‡æ€»","slug":"DB-doris-ç¼–è¯‘æŠ¥é”™æ±‡æ€»","date":"2025-09-26T01:09:04.000Z","updated":"2025-09-26T01:18:02.614Z","comments":true,"path":"2025/09/26/DB-doris-ç¼–è¯‘æŠ¥é”™æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/26/DB-doris-%E7%BC%96%E8%AF%91%E6%8A%A5%E9%94%99%E6%B1%87%E6%80%BB/","excerpt":"","text":"macos ç¼–è¯‘æŠ¥é”™ æŠ¥é”™1: mvn is not found ã€æŠ¥é”™ã€‘ âœ doris git:(master) bash build.shPython 3.11.6The JAVA_HOME environment variable is not defined correctly,this environment variable is needed to run this program.Error: mvn is not found ã€è§£å†³ã€‘ è®¾ç½® JAVA_HOME ç¯å¢ƒå˜é‡ã€‚ https://blog.csdn.net/watson2017/article/details/103243301 æŠ¥é”™2: ä»£ç  bug ã€æŠ¥é”™ã€‘ /Users/dragonliu/code/doris/be/src/vec/core/extended_types.h:42:8: error: reference to &#x27;is_signed&#x27; is ambiguous ã€è§£å†³ã€‘ ä»£ç  bugï¼Œæ–°ç‰ˆå·²ç»ä¿®å¤ï¼š https://github.com/apache/doris/commit/462db3d5bea5fe3e4e3b9c6e592b91ad2aff6ba4 æŠ¥é”™3: swapon: command not found ã€æŠ¥é”™ã€‘ âœ be git:(master) sh bin/start_be.sh --daemonbin/start_be.sh: line 86: swapon: command not found ã€è§£å†³ã€‘ ä¿®æ”¹ doris/output/be/bin/start_be.shï¼Œå°† swapon éƒ¨åˆ†æ³¨é‡Šæ‰ # if [[ &quot;$(swapon -s | wc -l)&quot; -gt 1 ]]; then# echo &quot;Please disable swap memory before installation.&quot;# exit 1# fi æŠ¥é”™4: command not found: mysql â†’ æœªè§£å†³ ã€æŠ¥é”™ã€‘ âœ bin git:(master) mysql -h 127.0.0.1 -P 9030 -u rootzsh: command not found: mysql ã€è§£å†³ã€‘ ä¸‹è½½ mysql client: brew install mysql-client å› ä¸ºä¸ mysql (which contains client libraries) å†²çªï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼š echo &#x27;export PATH=&quot;/usr/local/opt/mysql-client/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc~ source ~/.zshrc é”™è¯¯ï¼š âœ bin git:(master) mysql -h 127.0.0.1 -P 9030 -u rootERROR 2003 (HY000): Can&#x27;t connect to MySQL server on &#x27;127.0.0.1:9030&#x27; (61)","categories":[{"name":"DB","slug":"DB","permalink":"https://dragonliu2018.github.io/categories/DB/"},{"name":"doris","slug":"DB/doris","permalink":"https://dragonliu2018.github.io/categories/DB/doris/"}],"tags":[]},{"title":"[DB][doris] è¿è¡ŒæŠ¥é”™æ±‡æ€»","slug":"DB-doris-è¿è¡ŒæŠ¥é”™æ±‡æ€»","date":"2025-09-26T01:08:53.000Z","updated":"2025-09-26T15:57:32.850Z","comments":true,"path":"2025/09/26/DB-doris-è¿è¡ŒæŠ¥é”™æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/26/DB-doris-%E8%BF%90%E8%A1%8C%E6%8A%A5%E9%94%99%E6%B1%87%E6%80%BB/","excerpt":"","text":"Cluster default_cluster has no available capacity ã€é—®é¢˜ã€‘ å»ºè¡¨æŠ¥é”™ï¼š MySQL [demo]&gt; create table mytable ( k1 TINYINT, k2 DECIMAL(10, 2) DEFAULT &quot;10.05&quot;, k3 CHAR(10) COMMENT &quot;string column&quot;, k4 INT NOT NULL DEFAULT &quot;1&quot; COMMENT &quot;int column&quot; ) COMMENT &quot;my first table&quot; DISTRIBUTED BY HASH(k1) BUCKETS 1 PROPERTIES (&quot;replication_num&quot; = &quot;1&quot;);ERROR 1105 (HY000): errCode = 2, detailMessage = Cluster default_cluster has no available capacity ã€åŸå› ã€‘ æ²¡æœ‰å°† be æ·»åŠ åˆ°é›†ç¾¤ã€‚ MySQL [test]&gt; show backends;Empty set (0.03 sec) ã€è§£å†³ã€‘ æ·»åŠ  be åˆ°é›†ç¾¤ï¼š # ALTER SYSTEM ADD BACKEND &quot;be_host_ip:heartbeat_service_port&quot;;ALTER SYSTEM ADD BACKEND &quot;127.0.0.1:9050&quot;; ref: https://doris.apache.org/zh-CN/docs/2.1/gettingStarted/quick-start Failed to find 1 backends for policy ã€é—®é¢˜ã€‘ å»ºè¡¨æŠ¥é”™ï¼š MySQL [demo]&gt; create table mytable ( k1 TINYINT, k2 DECIMAL(10, 2) DEFAULT &quot;10.05&quot;, k3 CHAR(10) COMMENT &quot;string column&quot;, k4 INT NOT NULL DEFAULT &quot;1&quot; COMMENT &quot;int column&quot; ) COMMENT &quot;my first table&quot; DISTRIBUTED BY HASH(k1) BUCKETS 1 PROPERTIES (&quot;replication_num&quot; = &quot;1&quot;);ERROR 1105 (HY000): errCode = 2, detailMessage = Failed to find 1 backends for policy: cluster|query|load|schedule|tags|medium: default_cluster|false|false|true|[&#123;&quot;location&quot; : &quot;default&quot;&#125;]|HDD ã€åŸå› ã€‘ BE çš„ IP åœ°å€é”™è¯¯: MySQL [demo]&gt; show backends;+-----------+-----------------+-----------+---------------+--------+----------+----------+---------------+---------------+-------+----------------------+-----------------------+-----------+------------------+---------------+---------------+---------+----------------+--------------------------+--------------------------------------+---------+---------------------------------------------------------------------------------------------------------------+----------+| BackendId | Cluster | IP | HeartbeatPort | BePort | HttpPort | BrpcPort | LastStartTime | LastHeartbeat | Alive | SystemDecommissioned | ClusterDecommissioned | TabletNum | DataUsedCapacity | AvailCapacity | TotalCapacity | UsedPct | MaxDiskUsedPct | Tag | ErrMsg | Version | Status | NodeRole |+-----------+-----------------+-----------+---------------+--------+----------+----------+---------------+---------------+-------+----------------------+-----------------------+-----------+------------------+---------------+---------------+---------+----------------+--------------------------+--------------------------------------+---------+---------------------------------------------------------------------------------------------------------------+----------+| 11002 | default_cluster | 127.0.0.1 | 9050 | -1 | -1 | -1 | NULL | NULL | false | false | false | 0 | 0.000 | 1.000 B | 0.000 | 0.00 % | 0.00 % | &#123;&quot;location&quot; : &quot;default&quot;&#125; | actual backend local ip: 172.17.0.26 | | &#123;&quot;lastSuccessReportTabletsTime&quot;:&quot;N/A&quot;,&quot;lastStreamLoadTime&quot;:-1,&quot;isQueryDisabled&quot;:false,&quot;isLoadDisabled&quot;:false&#125; | |+-----------+-----------------+-----------+---------------+--------+----------+----------+---------------+---------------+-------+----------------------+-----------------------+-----------+------------------+---------------+---------------+---------+----------------+--------------------------+--------------------------------------+---------+---------------------------------------------------------------------------------------------------------------+----------+ ã€è§£å†³ã€‘ æ ¹æ®ä¸Šé¢çš„ ErrMsg æç¤ºï¼Œæ”¹æ­£ BE çš„ IP åœ°å€: MySQL [(none)]&gt; ALTER SYSTEM ADD BACKEND &quot;172.17.0.26:9050&quot;; mysql å¯ä»¥ç™»å½•ï¼Œä¸å¯ä»¥å»ºç«‹åˆ†åŒºè¡¨ â†’ å¤šä¸ª be ã€é—®é¢˜ã€‘ æ— æ³•å»ºç«‹åˆ†åŒºè¡¨ã€‚ ã€åŸå›  &amp; è§£å†³ã€‘ åŸå› æ˜¯æœ‰å¤šä¸ª be å®ä¾‹ï¼ˆå¯¹åº”å¤šä¸ªç½‘å¡ï¼‰ï¼Œåˆ é™¤å¤šä½™ beå³å¯ã€‚ SHOW PROC &#x27;/backends&#x27;; ALTER SYSTEM DROPP BACKEND &quot;59982&quot;; mysql å¯ä»¥ç™»å½•ï¼Œä¸å¯ä»¥å»ºç«‹åˆ†åŒºè¡¨ â†’ æ²¡æœ‰ be ã€é—®é¢˜ã€‘ æ— æ³•å»ºç«‹åˆ†åŒºè¡¨ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š ERROR 1105 (HY000): errCode = 2, detailMessage = System has no available disk capacity or no available BE nodes ã€åŸå›  &amp; è§£å†³ã€‘ åŸå› æ˜¯æ²¡æœ‰ be å®ä¾‹ï¼Œæ·»åŠ ä¸€ä¸ª be å®ä¾‹å¹¶ä¸”é‡å¯ be å³å¯ï¼š -- ALTER SYSTEM ADD BACKEND &quot;host:port&quot;;ALTER SYSTEM ADD BACKEND &quot;127.0.0.1:9050&quot;; mysql å¯ä»¥ç™»å½•ï¼Œä¸å¯ä»¥å»ºç«‹åˆ†åŒºè¡¨ â†’ be æ•°é‡ä¸å¤Ÿ ã€é—®é¢˜ã€‘ ä¸å¯ä»¥å»ºç«‹åˆ†åŒºè¡¨ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š ERROR 1105 (HY000): errCode = 2, detailMessage = replication num should be less than the number of available backends. replication num is 3, available backend num is 1 ã€åŸå› ã€‘ be æ•°é‡ä¸å¤Ÿã€‚ ã€è§£å†³ã€‘ åœ¨åˆ›å»º database çš„æ—¶å€™è¿›è¡ŒæŒ‡å®šï¼š create database test PROPERTIES (&quot;replication_allocation&quot;= &quot;tag.location.default: 1&quot; ); mysql å¯ä»¥ç™»å½•ï¼Œä¸å¯ä»¥å»ºç«‹åˆ†åŒºè¡¨ â†’ be æ•°é‡ä¸º0 ã€é—®é¢˜ã€‘ client æŠ¥é”™ ERROR 1105 (HY000): errCode = 2, detailMessage = errCode = 2, detailMessage = errCode = 2, detailMessage = replication num should be less than the number of available backends. replication num is 1, available backend num is 0 æ—¥å¿—æŠ¥é”™ æŸ¥çœ‹æ—¥å¿—å‘ç° be è¯´æ‰¾ä¸åˆ° feï¼Œfe æ‰¾ä¸åˆ° beã€‚ 12345678910111213I20240613 21:15:45.467008 1111236 mem_info.cpp:459] Refresh cgroup memory win, refresh again after 10s, cgroup mem limit: 9223372036854771712, cgroup mem usage: 13997985792, cgroup mem info cached: 0W20240613 21:15:49.361387 1110431 olap_server.cpp:714] Have not get FE Master heartbeat yetW20240613 21:15:50.491954 1109571 fragment_mgr.cpp:886] Could not find any running frontends, maybe we are upgrading? We will not cancel any running queries in this situation.I20240613 21:15:51.379978 1110598 task_worker_pool.cpp:686] waiting to receive first heartbeat from frontend before doing reportI20240613 21:15:51.836712 1110309 wal_manager.cpp:480] Scheduled(every 10s) WAL info: [/home/zhenlong/code/doris/output/be/storage/wal: limit 795363328 Bytes, used 0 Bytes, estimated wal bytes 0 Bytes, available 795363328 Bytes.];W20240613 21:15:52.586161 1116046 status.h:423] meet error status: [INTERNAL_ERROR]invalid cluster id. ignore. Record cluster id =789047984, record frontend info . Invalid cluster_id=1306576199, invalid frontend info TFrontendInfo(coordinator_address=TNetworkAddress(hostname=172.17.1.228, port=9020), process_uuid=1718284452423) 0# doris::Status doris::Status::Error&lt;6, true, int&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, int const&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;(std::basic_string_view&lt;char, std::char_traits&lt;char&gt; &gt;, int&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&amp;&amp;, int const&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&amp;&amp;) at /home/zhenlong/code/doris/be/src/common/status.h:422 1# doris::Status doris::Status::InternalError&lt;true, int&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;, int const&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; &gt;(std::basic_string_view&lt;char, std::char_traits&lt;char&gt; &gt;, int&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&amp;&amp;, int const&amp;, std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;&amp;&amp;) at /home/zhenlong/code/doris/be/src/common/status.h:468 2# doris::HeartbeatServer::_heartbeat(doris::TMasterInfo const&amp;) at /home/zhenlong/code/doris/be/src/agent/heartbeat_server.cpp:116 3# doris::HeartbeatServer::heartbeat(doris::THeartbeatResult&amp;, doris::TMasterInfo const&amp;) at /home/zhenlong/code/doris/be/src/agent/heartbeat_server.cpp:74 4# doris::HeartbeatServiceProcessor::process_heartbeat(int, apache::thrift::protocol::TProtocol*, apache::thrift::protocol::TProtocol*, void*) at /home/zhenlong/code/doris/gensrc/build/gen_cpp/HeartbeatService.cpp:298 5# doris::HeartbeatServiceProcessor::dispatchCall(apache::thrift::protocol::TProtocol*, apache::thrift:: ã€è§£å†³ã€‘åˆ é™¤ output ç›®å½•ä¸­çš„å­ç›®å½• fe å’Œ beï¼Œé‡æ–°ç¼–è¯‘å®‰è£…æˆåŠŸäº†ã€‚ ã€æ›´æ–°ã€‘åˆ é™¤ output/be/storage å†…å®¹ï¼Œé‡æ–°å¯åŠ¨ beã€‚ æ‰§è¡Œå›å½’æµ‹è¯•æ—¶å‡ºç° jar ç¼ºå¤±æŠ¥é”™ å›å½’æµ‹è¯•ï¼š ./run-regression-test.sh --run test_remove æŠ¥é”™ï¼š Could not resolve dependencies for project org.apache.doris:regression-test:jar:1.0-SNAPSHOT: Could not find artifact jdk.tools:jdk.tools:jar:1.7 at specified path /usr/lib/jvm/java-11-openjdk-amd64/../lib/tools.jar åŸå› æ˜¯ java11 ä¸‹æ²¡æœ‰å¯¹åº” jar åŒ…ï¼Œä½†æ˜¯ java8 ä¸‹æœ‰ï¼Œæ‰€ä»¥ JAVA_HOME æ”¹æˆ java8 å³å¯ï¼š export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64 feæ— æ³•å¯åŠ¨ï¼Œlogæ˜¾ç¤ºï¼šimage does not exist: /home/zhenlong/code/doris/output/fe/doris-meta/image/image.0 è§‚å¯Ÿ output/fe/log/fe.warn.logï¼Œå‘ç°æ˜¯å› ä¸ºç£ç›˜ç©ºé—´ä¸è¶³é€ æˆçš„ã€‚ beæ— æ³•å¯åŠ¨ -&gt; Address already in use ã€é—®é¢˜ã€‘ 1234567891011start BE in local modeDoris BE server did not start correctly, exiting*** Query id: 0-0 ****** is nereids: 0 ****** tablet id: 0 ****** Aborted at 1711251949 (unix time) try &quot;date -d @1711251949&quot; if you are using GNU date ****** Current BE git commitID: 2c377e69a9 ****** SIGSEGV address not mapped to object (@0x80) received by PID 2331840 (TID 2331840 OR 0x7f88bd98db80) from PID 128; stack trace: ***W20240324 11:45:45.365067 2333118 doris_main.cpp:125] thrift internal message: TServerSocket::listen() Could not bind to port 9060E20240324 11:45:45.365289 2333118 thrift_server.cpp:165] ThriftServer &#x27;backend&#x27; (on port: 9060) exited due to TException: Could not bind: Address already in use ã€è§£å†³ã€‘ è‹¥ä»æ²¡æœ‰è§£å†³ï¼Œåˆ™å…ˆkillæ‰beè¿›ç¨‹: lsof -i:9060 client æ— æ³•ç™»é™†ï¼Œ9030 ç«¯å£æ²¡å¼€å¯ ã€é—®é¢˜ã€‘ WARN (UNKNOWN fe_7e29d323_27e2_4414_88e0_65bca5217033(-1)|1) [Env.notifyNewFETypeTransfer():2612] notify new FE type transfer: UNKNOWN ã€è§£å†³ã€‘ æ¸…ç©ºfeçš„å…ƒæ•°æ®ç›®å½•doris-metaä¸‹çš„æ‰€æœ‰æ•°æ®ã€‚é‡æ–°å¯åŠ¨å³å¯ï¼š https://blog.csdn.net/u011385544/article/details/118603874 be å› ä¸º swap æ— æ³•å¯åŠ¨ /home/dragon/code/doris/output/be/bin/start_be.sh å»æ‰ä¸‹é¢çš„ï¼š if [[ &quot;$(swapon -s | wc -l)&quot; -gt 1 ]]; then echo &quot;Disable swap memory before starting be&quot; exit 1fi 1**ï¼ˆTO FIXï¼‰**fe æ— æ³•å¯åŠ¨ï¼šSLF4J: Class path contains multiple SLF4J bindings. ã€é—®é¢˜ã€‘ æŠ¥é”™ 123456789101112131415161718192021222324252627282930313233343536372024-06-12 17:58:35,795 INFO (main|1) [DorisFE.start():156] Doris FE starting...2024-06-12 17:58:35,798 INFO (main|1) [FrontendOptions.initAddrUseIp():101] local address: /192.168.1.103.2024-06-12 17:58:35,939 INFO (main|1) [ConsistencyChecker.initWorkTime():105] consistency checker will work from 23:00 to 23:002024-06-12 17:58:36,027 ERROR (main|1) [Util.report():128] SLF4J: Class path contains multiple SLF4J bindings.2024-06-12 17:58:36,027 ERROR (main|1) [Util.report():128] SLF4J: Found binding in [jar:file:/home/dragon/code/doris/output/fe/lib/slf4j-reload4j-1.7.36.jar!/org/slf4j/impl/StaticLoggerBinder.class]2024-06-12 17:58:36,027 ERROR (main|1) [Util.report():128] SLF4J: Found binding in [jar:file:/home/dragon/code/doris/output/fe/lib/log4j-slf4j-impl-2.18.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]2024-06-12 17:58:36,028 ERROR (main|1) [Util.report():128] SLF4J: See &lt;http://www.slf4j.org/codes.html#multiple_bindings&gt; for an explanation.2024-06-12 17:58:36,036 ERROR (main|1) [Util.report():128] SLF4J: Actual binding is of type [org.slf4j.impl.Reload4jLoggerFactory]2024-06-12 17:58:36,320 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] java.lang.ExceptionInInitializerError2024-06-12 17:58:36,320 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.catalog.AliasFunction.getExpr(AliasFunction.java:105)2024-06-12 17:58:36,321 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.catalog.AliasFunction.initBuiltins(AliasFunction.java:91)2024-06-12 17:58:36,321 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.catalog.FunctionSet.init(FunctionSet.java:97)2024-06-12 17:58:36,321 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.catalog.Env.&lt;init&gt;(Env.java:711)2024-06-12 17:58:36,321 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.catalog.EnvFactory.createEnv(EnvFactory.java:71)2024-06-12 17:58:36,321 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.catalog.Env$SingletonHolder.&lt;clinit&gt;(Env.java:656)2024-06-12 17:58:36,322 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.catalog.Env.getCurrentEnv(Env.java:815)2024-06-12 17:58:36,323 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.DorisFE.start(DorisFE.java:178)2024-06-12 17:58:36,323 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.DorisFE.main(DorisFE.java:95)2024-06-12 17:58:36,323 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] Caused by: java.lang.RuntimeException: Cannot find external parser table action_table.dat2024-06-12 17:58:36,323 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.analysis.SqlParser.loadTableFromFile(SqlParser.java:2964)2024-06-12 17:58:36,324 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] at org.apache.doris.analysis.SqlParser.&lt;clinit&gt;(SqlParser.java:604)2024-06-12 17:58:36,324 ERROR (main|1) [Throwable$WrappedPrintStream.println():763] ... 9 more2024-06-12 17:58:36,324 WARN (main|1) [DorisFE.start():225] java.lang.ExceptionInInitializerError: null at org.apache.doris.catalog.AliasFunction.getExpr(AliasFunction.java:105) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.catalog.AliasFunction.initBuiltins(AliasFunction.java:91) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.catalog.FunctionSet.init(FunctionSet.java:97) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.catalog.Env.&lt;init&gt;(Env.java:711) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.catalog.EnvFactory.createEnv(EnvFactory.java:71) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.catalog.Env$SingletonHolder.&lt;clinit&gt;(Env.java:656) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.catalog.Env.getCurrentEnv(Env.java:815) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.DorisFE.start(DorisFE.java:178) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.DorisFE.main(DorisFE.java:95) ~[doris-fe.jar:1.2-SNAPSHOT]Caused by: java.lang.RuntimeException: Cannot find external parser table action_table.dat at org.apache.doris.analysis.SqlParser.loadTableFromFile(SqlParser.java:2964) ~[doris-fe.jar:1.2-SNAPSHOT] at org.apache.doris.analysis.SqlParser.&lt;clinit&gt;(SqlParser.java:604) ~[doris-fe.jar:1.2-SNAPSHOT] ... 9 more ã€è§£å†³ã€‘ è§£å†³ï¼šåˆ é™¤ output/feï¼Œé‡æ–°ç¼–è¯‘ fe å³å¯ã€‚ æ¯æ¬¡ä¿®æ”¹å°‘é‡ fe ä»£ç ï¼Œé‡æ–°ç¼–è¯‘ feï¼Œéƒ½ä¼šé‡åˆ°è¿™ç§é—®é¢˜ï¼Œå¾…è§£å†³ã€‚ å¼€å‘æœºä¸Šåˆ é™¤ output/fe/doris_metaï¼Œé‡æ–°ç¼–è¯‘ fe å³å¯ã€‚ å‚è€ƒï¼š https://github.com/apache/doris/issues/29122 https://github.com/apache/doris/discussions/6610","categories":[{"name":"DB","slug":"DB","permalink":"https://dragonliu2018.github.io/categories/DB/"},{"name":"doris","slug":"DB/doris","permalink":"https://dragonliu2018.github.io/categories/DB/doris/"}],"tags":[]},{"title":"[Tool][opt] Instruments + speedsope å®‰è£…ä¸ä½¿ç”¨","slug":"Tool-opt-Instruments-speedsope-å®‰è£…ä¸ä½¿ç”¨","date":"2025-09-25T16:34:54.000Z","updated":"2025-09-26T00:58:05.704Z","comments":true,"path":"2025/09/26/Tool-opt-Instruments-speedsope-å®‰è£…ä¸ä½¿ç”¨/","permalink":"https://dragonliu2018.github.io/2025/09/26/Tool-opt-Instruments-speedsope-%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/","excerpt":"","text":"A å®‰è£…å¼•å­ åœ¨ macbook ä¸Šåš cmu 15445 fall 2022 p1 æ—¶ï¼Œp1 åœ¨çº¿æµ‹è¯•è¶…æ—¶äº†ï¼Œéœ€è¦è¿›è¡Œæ€§èƒ½è°ƒä¼˜ã€‚ä½†æ˜¯ macos ä¸Šæ²¡æœ‰ perfï¼Œè°ƒç ”åå‘ç°æ›¿ä»£ç‰© â†’ Instrumentsã€‚ æ­¥éª¤ Instruments é›†æˆåœ¨ xcode ä¸­ï¼Œæ‰€ä»¥å…ˆè¦å®‰è£… xcodeï¼ˆxcode ä½“ç§¯å¤§ï¼Œçº¦ 7Gï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„ macos å’Œ xcode çš„ç‰ˆæœ¬å¯¹åº” â†’ https://developer.apple.com/cn/support/xcode/ï¼Œä¸è¦ä¸‹è½½é”™äº†ç‰ˆæœ¬ğŸ¥¦ å¯ä»¥é€šè¿‡ App Store è¿›è¡Œä¸‹è½½ï¼Œæˆ–è€…é€šè¿‡è¿™ä¸ªé“¾æ¥ â†’ https://developer.apple.com/download/all/?q=for Xcode ã€å‚è€ƒã€‘å®‰è£…Xcodeçš„æ–¹æ³• B ä½¿ç”¨å¼•å­ Instruments æ˜¯ä¸€æ¬¾è‹¹æœè‡ªå¸¦çš„æµ‹è¯•å·¥å…·ï¼Œç”¨äºç›¸å…³çš„æ€§èƒ½åˆ†æå’ŒåŠ¨æ€è·Ÿè¸ªï¼Œå…¶ä¸­æœ‰å†…å­˜æ€§èƒ½æµ‹è¯•ï¼Œå›¾å½¢æ€§èƒ½æµ‹è¯•ã€å†…å­˜æ€§èƒ½æµ‹è¯•ç­‰ã€‚ æ‰“å¼€ xcodeï¼› é€šè¿‡å¯¼èˆªæ æ‰¾åˆ° Instrumentsï¼š æˆ–è€… command + ç©ºæ ¼ ç›´æ¥æœç´¢ Instruments å³å¯ã€‚ æ‰“å¼€ Time Profiler è¿›è¡Œæ€§èƒ½åˆ†æï¼š ä¸»è¦é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹å¼è¿›è¡Œè€—æ—¶åˆ†æï¼š 1 å¯æ‰§è¡Œç¨‹åº é€‰æ‹© å¯æ‰§è¡Œç¨‹åºï¼Œç„¶åç‚¹å‡» å¼€å§‹ å›¾æ ‡å³å¯ã€‚ âš ï¸ï¼šå½“æ—¶åˆ†æ cum 15445 fall 2022 p1 çš„æ—¶å€™ï¼Œè¿™ç§ä¸èƒ½å¾—å‡ºå¥½çš„ç»“æœï¼Œå°±ä½¿ç”¨äº†ä¸‹é¢è¿›ç¨‹çš„æ–¹å¼ã€‚ 2 è¿›ç¨‹ è¿™é‡Œé€‰æ‹©åˆ†æ æ‰€æœ‰è¿›ç¨‹ï¼Œå› ä¸ºè¦åˆ†æçš„æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸å¤ªå¥½æŠŠä»–ææˆä¸€ä¸ªè¿›ç¨‹ã€‚ ç‚¹å‡» å¼€å§‹ å›¾æ ‡ï¼Œæ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œç­‰å¾…ç›®æ ‡æ–‡ä»¶æ‰§è¡Œå®Œï¼Œç‚¹å‡» ç»“æŸ å›¾æ ‡ï¼› è¿™æ—¶å¯ä»¥çœ‹åˆ°åˆ†æç»“æœï¼Œç›®æ ‡æ–‡ä»¶ä¹Ÿåœ¨å…¶ä¸­ï¼š ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹ï¼Œå¯ä»¥å°†å…¶å•ç‹¬é¢†å‡ºæ¥ï¼Œç‚¹å‡»å³ä¾§ â¡ï¸ï¼› å¯ä»¥çœ‹åˆ° HardTest_4 çš„ä¸»è¦è€—æ—¶åœ¨ HistoryCmpLess() å‡½æ•°ä¸Šï¼š è€—æ—¶é›†ä¸­åœ¨ä¸‹é¢ä¸‰è¡Œä»£ç ï¼Œæ¨æµ‹æ˜¯ history_ çš„éšæœºå–æ•°æ®å¯¼è‡´æ€§èƒ½ä½ä¸‹ã€‚ æŸ¥çœ‹ history_ ç±»å‹ï¼Œæœç„¶æ˜¯ map ç±»å‹ï¼Œä½†æ˜¯ä½¿ç”¨ unordered_map æ›´åŠ é«˜æ•ˆã€‚æ›´æ¢æ•°æ®ç±»å‹åï¼Œè€—æ—¶ä¸‹é™åˆ° 7sï¼Œç¬¦åˆé¢„æœŸã€‚ 3 ç«ç„°å›¾ å°±å¯ä»¥åˆ©ç”¨ speedsope ç”Ÿæˆç«ç„°å›¾ï¼š speedscope X å‚è€ƒ Instrumentå·¥å…·ä½¿ç”¨","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"opt","slug":"Tool/opt","permalink":"https://dragonliu2018.github.io/categories/Tool/opt/"}],"tags":[]},{"title":"[Tool][opt] C++ benchmark","slug":"Tool-opt-C-benchmark","date":"2025-09-25T16:30:37.000Z","updated":"2025-09-25T16:37:20.394Z","comments":true,"path":"2025/09/26/Tool-opt-C-benchmark/","permalink":"https://dragonliu2018.github.io/2025/09/26/Tool-opt-C-benchmark/","excerpt":"","text":"1 ç¼–è¯‘ clone ä»“åº“ï¼šgit clone https://github.com/google/benchmark.git æ–°å»º buildï¼š cd benchmarkmkdir buildcd build cmake &amp; ä¸‹è½½ä¾èµ–: cmake -DBENCHMARK_DOWNLOAD_DEPENDENCIES=on -DCMAKE_BUILD_TYPE=Release ../ ç¼–è¯‘ï¼š cmake --build &quot;build&quot; --config Release 2 ç¼–å†™æµ‹è¯• 3 åœ¨çº¿ benchmark https://quick-bench.com/q/6tDxsmk3FMX55B8W1RrdiG_s7_k X å‚è€ƒ","categories":[{"name":"PL","slug":"PL","permalink":"https://dragonliu2018.github.io/categories/PL/"},{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"C++","slug":"PL/C","permalink":"https://dragonliu2018.github.io/categories/PL/C/"},{"name":"opt","slug":"Tool/opt","permalink":"https://dragonliu2018.github.io/categories/Tool/opt/"}],"tags":[]},{"title":"[Tool][opt] gperf å®‰è£…ä½¿ç”¨æ•™ç¨‹","slug":"Tool-opt-gperf-å®‰è£…ä½¿ç”¨æ•™ç¨‹","date":"2025-09-25T16:28:23.000Z","updated":"2025-09-25T16:38:29.450Z","comments":true,"path":"2025/09/26/Tool-opt-gperf-å®‰è£…ä½¿ç”¨æ•™ç¨‹/","permalink":"https://dragonliu2018.github.io/2025/09/26/Tool-opt-gperf-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/","excerpt":"","text":"1 ä»‹ç» https://github.com/gperftools/gperftools gperftools æ˜¯è°·æ­Œæ¨å‡ºçš„ä¸€å¥—éå¸¸å¼ºå¤§çš„æ€§èƒ½åˆ†æå·¥å…·é›†. å®ƒä¸»è¦æœ‰è¿™ä¸‰ä¸ªåŠŸèƒ½: åˆ†æ CPU æ€§èƒ½, èƒ½å¤Ÿç»Ÿè®¡å‡ºä¸€æ®µæ—¶é—´å†…å„ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´, å¸®åŠ©æˆ‘ä»¬æ‰¾å‡ºè€—æ—¶çš„ä»£ç ; åˆ†æå†…å­˜å ç”¨æƒ…å†µ, èƒ½å¤Ÿç»Ÿè®¡å‡ºæŸä¸€æ—¶åˆ»å„ä¸ªå‡½æ•°åˆ†é…çš„å†…å­˜å¤§å°, å¸®åŠ©æˆ‘ä»¬æ‰¾å‡ºå†…å­˜å ç”¨é«˜çš„ä»£ç , ä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬å®šä½å†…å­˜æ³„éœ²; è‡ªåŠ¨æ£€æŸ¥å†…å­˜æ³„éœ². gperftools è¿˜åŒ…å«ä¸€ä¸ªé«˜æ€§èƒ½å†…å­˜åˆ†é…å™¨ tcmalloc, æˆ‘ä»¬å¯ä»¥ç”¨å®ƒä»£æ›¿ glibc çš„ ptmalloc. tcmalloc è‡ªå¸¦ç»Ÿè®¡åŠŸèƒ½, å†…å­˜åˆ†æå’Œæ£€æŸ¥å†…å­˜æ³„éœ²å°±é å®ƒ. æœ¬æ–‡ä»‹ç» gperftools åœ¨ Linux ä¸‹çš„ä¸€äº›å¸¸è§çš„ç”¨æ³•. å¦‚æœä½ éœ€è¦ä½¿ç”¨ gperftools åˆ†æ Linux (æœåŠ¡å™¨) ç¨‹åº, è¿™ç¯‡æ–‡ç« å¯ä»¥å½“ä½œä¸€ä¸ª Quick Start. 2 å®‰è£… æ–¹æ³•1ï¼š ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; &lt; /dev/null 2&gt; /dev/null æ–¹æ³•2: brew install gperftools 3 ä½¿ç”¨ X å‚è€ƒ Install â€œperfâ€ on Mac ä½¿ç”¨ gperftools åˆ†æç¨‹åºæ€§èƒ½","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"opt","slug":"Tool/opt","permalink":"https://dragonliu2018.github.io/categories/Tool/opt/"}],"tags":[]},{"title":"[Tool][opt] perf å®‰è£…ä½¿ç”¨æ•™ç¨‹","slug":"Tool-opt-perf-å®‰è£…ä½¿ç”¨æ•™ç¨‹","date":"2025-09-25T16:24:37.000Z","updated":"2025-09-25T16:38:14.178Z","comments":true,"path":"2025/09/26/Tool-opt-perf-å®‰è£…ä½¿ç”¨æ•™ç¨‹/","permalink":"https://dragonliu2018.github.io/2025/09/26/Tool-opt-perf-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/","excerpt":"","text":"1 ubuntu å®‰è£…æ­¥éª¤ å®‰è£…linux-tools-commonï¼š sudo apt-get install linux-tools-common æ­¤æ—¶è¿è¡Œperfä»ç„¶å¤±è´¥ï¼š âœ matrixdb git:(main) âœ— perfWARNING: perf not found for kernel 5.15.0-69 You may need to install the following packages for this specific kernel: linux-tools-5.15.0-69-generic linux-cloud-tools-5.15.0-69-generic You may also want to install one of the following packages to keep up to date: linux-tools-generic linux-cloud-tools-generic æ ¹æ®æç¤ºå…ˆè¿›è¡Œå¯¹åº”åŒ…çš„æ›´æ–°ï¼š sudo apt-get install linux-tools-generic linux-cloud-tools-generic ä¸‹è½½å¯¹åº”åŒ…ï¼š sudo apt-get install linux-tools-5.15.0-69-generic linux-cloud-tools-5.15.0-69-generic è¿›è¡ŒéªŒè¯ï¼Œä¸‹è½½æˆåŠŸï¼š âœ matrixdb git:(main) âœ— perf -vperf version 5.15.87 2 å¸è½½ sudo apt-get remove linux-tools-common linux-tools-$(uname -r) linux-cloud-tools-$(uname -r) 3 æŠ¥é”™ 3.1 æŠ¥é”™1ï¼šThe cpu_core/cycles/ event is not supported. âœ build git:(p1) âœ— sudo perf record ./test/buffer_pool_manager_instance_testError:The cpu_core/cycles/ event is not supported. åœ¨å…¬å¸ macbook ä¸Šæ²¡æœ‰å‡ºç°æŠ¥é”™ï¼Œåœ¨å®éªŒå®¤ win11 ä¸Šå‡ºç°ä¸Šè¿°é—®é¢˜ã€‚ å‚è€ƒ è™šæ‹ŸæœºLinuxä½¿ç”¨perf statæç¤ºcycles not supportedï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š å…³é—­VMwareè™šæ‹Ÿæœºç”µæºï¼Œæ‰¾åˆ°ç¡¬ä»¶é…ç½®é€‰é¡¹ä¸­CPU å‹¾é€‰â˜‘ï¸è™šæ‹ŸåŒ–CPUæ€§èƒ½è®¡æ•°å™¨ é‡å¯é—®é¢˜è§£å†³ï¼ˆä½†æ˜¯æˆ‘çš„æœºå™¨å‹¾é€‰åæ— æ³•å¯åŠ¨è™šæ‹Ÿæœºäº†ğŸ¥¦ 4 ä½¿ç”¨ 4.1 æŠ“å–æ€§èƒ½ä¿¡æ¯ # è¿›ç¨‹sudo perf record --call-graph=dwarf -p 479061# å¯æ‰§è¡Œæ–‡ä»¶sudo perf record --call-graph=dwarf ./exec 4.2 ç»“æœå±•ç¤º sudo perf report -i perf.data --no-inline -g 4.3 å¿«æ·é”® å±•å¼€ï¼šshift + + X å‚è€ƒ åŸºäºUbuntu 18.04 å®‰è£…perfå·¥å…· How To Install perf-tools-unstable on Ubuntu 22.04","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"opt","slug":"Tool/opt","permalink":"https://dragonliu2018.github.io/categories/Tool/opt/"}],"tags":[]},{"title":"[PL][C++] æ€§èƒ½ä¼˜åŒ–æ±‡æ€»","slug":"PL-C-æ€§èƒ½ä¼˜åŒ–æ±‡æ€»","date":"2025-09-25T16:06:51.000Z","updated":"2025-09-25T16:20:12.162Z","comments":true,"path":"2025/09/26/PL-C-æ€§èƒ½ä¼˜åŒ–æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/26/PL-C-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%B1%87%E6%80%BB/","excerpt":"","text":"å¸¸ç”¨æŠ€å·§ é¿å…æ„é€ ä¸å¿…è¦çš„å¯¹è±¡ï¼Œä¾‹å¦‚ std::string å‡½æ•°è¿”å›å€¼ä¸ºå¸¸é‡å­—ç¬¦ä¸²æ—¶ï¼Œä¸”éœ€è¦ std::string_view ç±»å‹ï¼›å‡½æ•°è¿”å›å€¼ç±»å‹å¯ä»¥è®¾ä¸º std::string_viewï¼Œå¦‚æœè®¾ä¸º std::stringï¼Œä¼šæœ‰å¤šä½™çš„æ‹·è´ã€‚ åˆ†æ”¯é¢„æµ‹ &amp; unlikely refï¼šhttps://www.zhihu.com/question/639443238 é¿å…åå¤æ„é€ å’Œææ„ vector ã€çƒ­ç‚¹ã€‘ é—®é¢˜æ¥æºäº YMatrix å®ä¹ ï¼Œä¸‹é¢çš„ vector å£°æ˜åœ¨äº† for å¾ªç¯å†…éƒ¨ï¼Œæ¯æ¬¡éå†éƒ½ä¼šè¿›è¡Œæ„é€ å’Œææ„ï¼Œæˆæœ¬è¾ƒå¤§ã€‚ for (std::size_t i = 0; i &lt; times; ++i) &#123; std::vector&lt;std::uint32_t&gt; idx_chain; func(idx_chain);&#125; ã€ä¼˜åŒ–ã€‘ å¯ä»¥å°† vector å£°æ˜ä½ç½®æåˆ° for å¾ªç¯å¤–éƒ¨ï¼Œæ¯æ¬¡éå†å¯¹ vector è¿›è¡Œ clear å³å¯ std::vector&lt;std::uint32_t&gt; idx_chain;for (std::size_t i = 0; i &lt; times; ++i) &#123; idx_chain.clear(); func(idx_chain);&#125; vector ä½¿ç”¨ reserve é¿å…é‡å¤å†…å­˜ç”³è¯·ä¸æ•°æ®å¤åˆ¶ åœºæ™¯ä»‹ç» å½“ä½¿ç”¨ vector æ—¶ï¼Œå¦‚æœå·²çŸ¥éœ€è¦å¤šå°‘å…ƒç´ çš„ç©ºé—´ï¼Œåˆ™ä½¿ç”¨ reserve å‡½æ•°é¢„å…ˆåˆ†é…è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œå‡å°‘åŠ¨æ€å†…å­˜åˆ†é…å’Œå…ƒç´ å¤åˆ¶çš„æ¬¡æ•°ã€‚è¿™ä½¿å¾—æ’å…¥æ“ä½œæ›´åŠ é«˜æ•ˆï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œæ€§èƒ½ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚ ä»£ç éªŒè¯ ã€é“¾æ¥ã€‘https://quick-bench.com/q/ctDLCeIqzoycLX9KUuBajAapaUA ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142#include &lt;bits/stdc++.h&gt;using namespace std;constexpr int SIZE = 10000;int vector_push_back_one_by_one() &#123; std::vector&lt;std::string&gt; str_vec; for (int i = 0; i &lt; SIZE; i++) &#123; str_vec.push_back(std::to_string(i)); &#125; return 0;&#125;int vector_push_back_reserve() &#123; std::vector&lt;std::string&gt; str_vec; str_vec.reserve(SIZE); for (int i = 0; i &lt; SIZE; i++) &#123; str_vec.push_back(std::to_string(i)); &#125; return 0;&#125;static void PushOneByOne(benchmark::State&amp; state) &#123; // Code inside this loop is measured repeatedly for (auto _ : state) &#123; auto ret = vector_push_back_one_by_one(); // Make sure the variable is not optimized away by compiler benchmark::DoNotOptimize(ret); &#125;&#125;// Register the function as a benchmarkBENCHMARK(PushOneByOne);static void PushReserve(benchmark::State&amp; state) &#123; // Code before the loop is not measured for (auto _ : state) &#123; auto ret = vector_push_back_reserve(); // Make sure the variable is not optimized away by compiler benchmark::DoNotOptimize(ret); &#125;&#125;BENCHMARK(PushReserve); GPT ç°è±¡è§£é‡Š vector_push_back_reserve å‡½æ•°æ¯” vector_push_back_one_by_one å‡½æ•°é«˜æ•ˆçš„åŸå› ä¸»è¦åœ¨äºå†…å­˜åˆ†é…ç­–ç•¥çš„ä¸åŒã€‚ vector_push_back_one_by_one å‡½æ•° åŠ¨æ€å†…å­˜åˆ†é…ï¼šstd::vector çš„ push_back æ–¹æ³•ä¼šåœ¨å®¹å™¨å®¹é‡ä¸è¶³æ—¶ï¼Œè‡ªåŠ¨åˆ†é…æ–°çš„å†…å­˜æ¥å­˜å‚¨æ›´å¤šçš„å…ƒç´ ã€‚æ¯æ¬¡åˆ†é…çš„å†…å­˜å¤§å°é€šå¸¸æ˜¯å½“å‰å®¹é‡çš„ä¸¤å€å·¦å³ï¼ˆå…·ä½“ç­–ç•¥å› æ ‡å‡†åº“å®ç°è€Œå¼‚ï¼‰ã€‚ä¾‹å¦‚ï¼Œåˆå§‹å®¹é‡å¯èƒ½ä¸º 0ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ push_back æ—¶åˆ†é…ä¸€å®šå¤§å°çš„å†…å­˜ï¼ˆå¦‚ 16 ä¸ªå…ƒç´ çš„ç©ºé—´ï¼‰ï¼Œå½“æ’å…¥ç¬¬ 17 ä¸ªå…ƒç´ æ—¶ï¼Œä¼šé‡æ–°åˆ†é…å†…å­˜ï¼ˆå¦‚ 32 ä¸ªå…ƒç´ çš„ç©ºé—´ï¼‰ï¼Œå¹¶å°†åŸæœ‰å…ƒç´ å¤åˆ¶åˆ°æ–°çš„å†…å­˜ç©ºé—´ä¸­ï¼Œç„¶åé‡Šæ”¾æ—§çš„å†…å­˜ç©ºé—´ã€‚ å¤šæ¬¡å†…å­˜åˆ†é…å’Œå¤åˆ¶ï¼šåœ¨æ’å…¥å¤§é‡å…ƒç´ æ—¶ï¼Œè¿™ç§åŠ¨æ€å†…å­˜åˆ†é…ä¼šå¯¼è‡´å¤šæ¬¡å†…å­˜åˆ†é…å’Œå¤åˆ¶æ“ä½œã€‚æ¯æ¬¡é‡æ–°åˆ†é…å†…å­˜æ—¶ï¼Œéƒ½éœ€è¦å°†å·²æœ‰çš„å…ƒç´ å¤åˆ¶åˆ°æ–°çš„å†…å­˜ç©ºé—´ä¸­ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡çš„æ—¶é—´å’Œè®¡ç®—èµ„æºã€‚éšç€å…ƒç´ æ•°é‡çš„å¢åŠ ï¼Œè¿™ç§å¼€é”€ä¼šé€æ¸ç´¯ç§¯ï¼Œå¯¼è‡´æ•´ä½“æ€§èƒ½ä¸‹é™ã€‚ vector_push_back_reserve å‡½æ•° é¢„å…ˆåˆ†é…å†…å­˜ï¼šstd::vector çš„ reserve æ–¹æ³•å…è®¸åœ¨å®¹å™¨åˆ›å»ºæ—¶é¢„å…ˆåˆ†é…è¶³å¤Ÿçš„å†…å­˜æ¥å­˜å‚¨æŒ‡å®šæ•°é‡çš„å…ƒç´ ã€‚åœ¨ vector_push_back_reserve å‡½æ•°ä¸­ï¼Œé€šè¿‡è°ƒç”¨ str_vec.reserve(SIZE)ï¼Œé¢„å…ˆåˆ†é…äº†è¶³å¤Ÿå­˜å‚¨ SIZE ä¸ª std::string å…ƒç´ çš„å†…å­˜ç©ºé—´ã€‚ å‡å°‘å†…å­˜åˆ†é…å’Œå¤åˆ¶ï¼šç”±äºé¢„å…ˆåˆ†é…äº†è¶³å¤Ÿçš„å†…å­˜ï¼Œåç»­è°ƒç”¨ push_back æ–¹æ³•æ—¶ï¼Œä¸éœ€è¦å†è¿›è¡ŒåŠ¨æ€å†…å­˜åˆ†é…å’Œå…ƒç´ å¤åˆ¶æ“ä½œã€‚æ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥ç›´æ¥æ’å…¥åˆ°é¢„å…ˆåˆ†é…çš„å†…å­˜ç©ºé—´ä¸­ï¼Œä»è€Œé¿å…äº†å¤šæ¬¡å†…å­˜åˆ†é…å’Œå¤åˆ¶çš„å¼€é”€ï¼Œæ˜¾è‘—æé«˜äº†æ’å…¥æ“ä½œçš„æ•ˆç‡ã€‚ æ€§èƒ½å¯¹æ¯” æ—¶é—´å¤æ‚åº¦ï¼švector_push_back_one_by_one çš„æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn)ï¼Œå› ä¸ºæ¯æ¬¡é‡æ–°åˆ†é…å†…å­˜æ—¶ï¼Œéƒ½éœ€è¦å¤åˆ¶å·²æœ‰çš„å…ƒç´ ï¼Œè€Œå¤åˆ¶æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸å½“å‰å…ƒç´ æ•°é‡æˆæ­£æ¯”ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œvector_push_back_reserve çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œå› ä¸ºæ‰€æœ‰å…ƒç´ éƒ½å¯ä»¥ç›´æ¥æ’å…¥åˆ°é¢„å…ˆåˆ†é…çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ— éœ€é¢å¤–çš„å¤åˆ¶æ“ä½œã€‚ å®é™…æ€§èƒ½ï¼šåœ¨å®é™…è¿è¡Œä¸­ï¼Œvector_push_back_reserve å‡½æ•°çš„æ‰§è¡Œæ—¶é—´é€šå¸¸æ¯” vector_push_back_one_by_one å‡½æ•°çŸ­å¾—å¤šï¼Œå°¤å…¶æ˜¯åœ¨æ’å…¥å¤§é‡å…ƒç´ æ—¶ã€‚è¿™æ˜¯å› ä¸º vector_push_back_one_by_one å‡½æ•°éœ€è¦è¿›è¡Œå¤šæ¬¡å†…å­˜åˆ†é…å’Œå¤åˆ¶æ“ä½œï¼Œè€Œ vector_push_back_reserve å‡½æ•°åªéœ€è¦ä¸€æ¬¡å†…å­˜åˆ†é…ï¼Œåç»­çš„æ’å…¥æ“ä½œéå¸¸é«˜æ•ˆã€‚ unordered_map æ›¿æ¢ map é—®é¢˜ é—®é¢˜æ¥è‡ªä¸ cmu 15-445 fall 2022 p1ï¼Œå½“æ—¶åœ¨çº¿æµ‹è¯•HardTest_4 è¶…æ—¶ï¼ˆä¸Šé™æ˜¯ 10sï¼Œå½“æ—¶ç¨‹åºè€—æ—¶ 14sï¼‰ã€‚ è°ƒä¼˜ åœ¨ macbook ä¸Šè·‘çš„é¡¹ç›®ï¼Œæ²¡æœ‰ perf åˆ†æå·¥å…·ï¼Œä½¿ç”¨ macos ä¸­çš„ Instruments è¿›è¡Œåˆ†æã€‚ å¯ä»¥çœ‹åˆ° HardTest_4 çš„ä¸»è¦è€—æ—¶åœ¨ HistoryCmpLess() å‡½æ•°ä¸Šï¼š è€—æ—¶é›†ä¸­åœ¨ä¸‹é¢ä¸‰è¡Œä»£ç ï¼Œæ¨æµ‹æ˜¯ history_ çš„éšæœºå–æ•°æ®å¯¼è‡´æ€§èƒ½ä½ä¸‹ã€‚ æŸ¥çœ‹ history_ ç±»å‹ï¼Œæœç„¶æ˜¯ map ç±»å‹ï¼Œä½†æ˜¯ä½¿ç”¨ unordered_map æ›´åŠ é«˜æ•ˆã€‚æ›´æ¢æ•°æ®ç±»å‹åï¼Œè€—æ—¶ä¸‹é™åˆ° 7sï¼Œç¬¦åˆé¢„æœŸã€‚","categories":[{"name":"PL","slug":"PL","permalink":"https://dragonliu2018.github.io/categories/PL/"},{"name":"C++","slug":"PL/C","permalink":"https://dragonliu2018.github.io/categories/PL/C/"}],"tags":[]},{"title":"[Tool] docker ä½¿ç”¨æŠ€å·§æ±‡æ€»","slug":"Tool-docker-ä½¿ç”¨æŠ€å·§æ±‡æ€»","date":"2025-09-25T11:56:32.000Z","updated":"2025-09-25T16:01:36.310Z","comments":true,"path":"2025/09/25/Tool-docker-ä½¿ç”¨æŠ€å·§æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/25/Tool-docker-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/","excerpt":"","text":"å¯¼å‡ºå¯¼å…¥é•œåƒ # å¯¼å‡ºé•œåƒdocker save -o doris.tar apache/doris:build-env-ldb-toolchain-latest# å¯¼å…¥é•œåƒdocker load -i doris.tar","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"docker","slug":"Tool/docker","permalink":"https://dragonliu2018.github.io/categories/Tool/docker/"}],"tags":[]},{"title":"[PL][Python] ç¼–ç¨‹æŠ€å·§æ±‡æ€»","slug":"PL-Python-ç¼–ç¨‹æŠ€å·§æ±‡æ€»","date":"2025-09-24T15:47:34.000Z","updated":"2025-09-24T15:48:11.695Z","comments":true,"path":"2025/09/24/PL-Python-ç¼–ç¨‹æŠ€å·§æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/24/PL-Python-%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/","excerpt":"","text":"","categories":[{"name":"PL","slug":"PL","permalink":"https://dragonliu2018.github.io/categories/PL/"},{"name":"Python","slug":"PL/Python","permalink":"https://dragonliu2018.github.io/categories/PL/Python/"}],"tags":[]},{"title":"[PL][Python] å¸¸è§ bug æ±‡æ€»","slug":"PL-Python-å¸¸è§-bug-æ±‡æ€»","date":"2025-09-24T15:47:16.000Z","updated":"2025-09-24T15:51:51.209Z","comments":true,"path":"2025/09/24/PL-Python-å¸¸è§-bug-æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/24/PL-Python-%E5%B8%B8%E8%A7%81-bug-%E6%B1%87%E6%80%BB/","excerpt":"","text":"sort() &amp; sorted() å¯¹æ¯”ä¸¤ä¸ªåˆ—è¡¨æ˜¯å¦å«æœ‰ç›¸åŒçš„å…ƒç´ ï¼Œä¸éœ€è¦é¡ºåºä¸€æ ·ã€‚sort() å‡½æ•°è¿”å› Noneï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä½¿ç”¨ method-1 è¿›è¡Œåˆ¤æ–­ã€‚ # method-1 errorif l1.sort() == l2.sort(): xxx# method-2 OKif sorted(l1) == sorted(l2): xxx","categories":[{"name":"PL","slug":"PL","permalink":"https://dragonliu2018.github.io/categories/PL/"},{"name":"Python","slug":"PL/Python","permalink":"https://dragonliu2018.github.io/categories/PL/Python/"}],"tags":[]},{"title":"[Tool] github ä½¿ç”¨æŠ€å·§æ±‡æ€»","slug":"Tool-github-ä½¿ç”¨æŠ€å·§æ±‡æ€»","date":"2025-09-24T14:45:16.000Z","updated":"2025-09-24T15:43:04.789Z","comments":true,"path":"2025/09/24/Tool-github-ä½¿ç”¨æŠ€å·§æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/24/Tool-github-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/","excerpt":"","text":"æ–°å¢ SSH å¯†é’¥åˆ° GitHub å¸æˆ· ç”Ÿæˆ keyï¼Œä¸€è·¯é»˜è®¤å³å¯ï¼š âœ .ssh ssh-keygen å¤åˆ¶ id_rsa.pub æ–‡ä»¶ä¸­çš„å†…å®¹åˆ° GitHubï¼š âœ .ssh cat id_rsa.pub æµ‹è¯•æ˜¯å¦é…ç½®æˆåŠŸï¼š âœ .ssh ssh -T git@github.comHi Dragonliu2018! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"git","slug":"Tool/git","permalink":"https://dragonliu2018.github.io/categories/Tool/git/"}],"tags":[]},{"title":"[Tool] git æŠ¥é”™æ±‡æ€»","slug":"Tool-git-æŠ¥é”™æ±‡æ€»","date":"2025-09-24T14:44:11.000Z","updated":"2025-09-24T15:43:06.611Z","comments":true,"path":"2025/09/24/Tool-git-æŠ¥é”™æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/24/Tool-git-%E6%8A%A5%E9%94%99%E6%B1%87%E6%80%BB/","excerpt":"","text":"","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"git","slug":"Tool/git","permalink":"https://dragonliu2018.github.io/categories/Tool/git/"}],"tags":[]},{"title":"[Tool] git ä½¿ç”¨æŠ€å·§æ±‡æ€»","slug":"Tool-git-ä½¿ç”¨æŠ€å·§æ±‡æ€»","date":"2025-09-24T14:21:50.000Z","updated":"2025-09-26T15:35:54.680Z","comments":true,"path":"2025/09/24/Tool-git-ä½¿ç”¨æŠ€å·§æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/24/Tool-git-%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7%E6%B1%87%E6%80%BB/","excerpt":"","text":"å°†å½“å‰ä¿®æ”¹å‹åˆ° HEAD commit git commit --amend å–æ¶ˆæŸä¸ªæ–‡ä»¶çš„æ›´æ”¹ git checkout -- &lt;file_name&gt; å‚è€ƒï¼šhttps://blog.csdn.net/qq_32907195/article/details/115333898 åˆ é™¤æŸä¸ªæ–‡ä»¶(å¤¹) # æ¨ègit rm &lt;file_name&gt;# ç›¸å½“äºrm &lt;file_name&gt;git add &lt;file_name&gt; ignore å·²ç» push åˆ°è¿œç«¯çš„æ–‡ä»¶ ã€é—®é¢˜ã€‘ .vscode æ–‡ä»¶å¤¹å·²ç» push åˆ°è¿œç¨‹ï¼Œå¦‚ä½• ignoreï¼Ÿ ã€è§£å†³ã€‘ ä» Git ç´¢å¼•ä¸­ç§»é™¤ .vscode ç›®å½•ï¼ˆä¸ä¼šåˆ é™¤æœ¬åœ°æ–‡ä»¶å¤¹ï¼Œåªæ˜¯è®© git ä¸å†è·Ÿè¸ªå®ƒï¼‰ï¼š âœ SG-DQA git:(main) git rm -r --cached .vscoderm &#x27;.vscode/launch.json&#x27;rm &#x27;.vscode/settings.json&#x27; æ·»åŠ  .gitignore æ–‡ä»¶ .vscode/ git add &amp; git commit &amp; git push åˆå¹¶å¤šä¸ª commit # method-1git rebase -i origin/main# method-2git rebase -i ce75153a87# method-3: ä¸è¦åˆå¹¶çš„commitæ•°é‡ä¸€è‡´git rebase -i HEAD~8 patch git diff &gt; xx.patchgit apply x.patch æœ¬åœ°åˆ†æ”¯ &amp; è¿œç¨‹åˆ†æ”¯ # æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯å…³è”ï¼ˆè·Ÿè¸ªï¼‰çš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´çš„å¯¹åº”å…³ç³»git branch -vv# æ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ï¼ˆæ²¡æœ‰å¯¹åº”åˆ†æ”¯ï¼‰git push -f --set-upstream origin dragonliu/dictionary_mysql_opt# è®¾ç½®æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„å…³è”git branch --set-upstream-to=origin/&lt;è¿œç¨‹åˆ†æ”¯å&gt; åˆ é™¤åˆ†æ”¯ # åˆ é™¤æœ¬åœ°åˆ†æ”¯git branch -D fix/authentication# åˆ é™¤è¿œç¨‹åˆ†æ”¯ git push origin --delete fix/authentication æ’¤é”€ commit # æ’¤é”€æœ¬åœ° commitgit reset --soft HEAD^# æ’¤é”€è¿œç¨‹ commitgit reset HEAD^git push -f ä¿®æ”¹è¿œç¨‹ä»“åº“é“¾æ¥ git remote set-url origin git@github.com:Dragonliu2018/doris.git åˆ‡æ¢ tag # æŸ¥çœ‹å¯¹åº” tag çš„ä»£ç ï¼Œè¿™æ—¶å€™ git å¯èƒ½ä¼šæç¤ºä½ å½“å‰å¤„äºä¸€ä¸ªâ€œdetached HEAD&quot; çŠ¶æ€ã€‚# å› ä¸º tag ç›¸å½“äºæ˜¯ä¸€ä¸ªå¿«ç…§ï¼Œæ˜¯ä¸èƒ½æ›´æ”¹å®ƒçš„ä»£ç çš„ã€‚git checkout tag_name# åŸºäº tag commit è¿›è¡Œä¿®æ”¹# å¦‚æœè¦åœ¨ tag ä»£ç çš„åŸºç¡€ä¸Šåšä¿®æ”¹ï¼Œä½ éœ€è¦ä¸€ä¸ªåˆ†æ”¯git checkout -b branch_name tag_name","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"git","slug":"Tool/git","permalink":"https://dragonliu2018.github.io/categories/Tool/git/"}],"tags":[]},{"title":"[Tool] wsl æŠ¥é”™æ±‡æ€»","slug":"Tool-wsl-æŠ¥é”™æ±‡æ€»","date":"2025-09-24T14:08:37.000Z","updated":"2025-09-24T14:12:11.127Z","comments":true,"path":"2025/09/24/Tool-wsl-æŠ¥é”™æ±‡æ€»/","permalink":"https://dragonliu2018.github.io/2025/09/24/Tool-wsl-%E6%8A%A5%E9%94%99%E6%B1%87%E6%80%BB/","excerpt":"","text":"æ‰§è¡Œ systemctl å¤±è´¥ ã€é—®é¢˜ã€‘ System has not been booted with systemd as init system (PID 1). Can&#x27;t operate. Failed to connect to bus: Host is down ã€è§£å†³ã€‘ https://github.com/microsoft/WSL/issues/8883","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"wsl","slug":"Tool/wsl","permalink":"https://dragonliu2018.github.io/categories/Tool/wsl/"}],"tags":[]},{"title":"[databend] pivot æ”¯æŒ subquery","slug":"databend-pivot-æ”¯æŒ-subquery","date":"2025-09-14T09:45:42.000Z","updated":"2025-09-23T01:06:58.364Z","comments":true,"path":"2025/09/14/databend-pivot-æ”¯æŒ-subquery/","permalink":"https://dragonliu2018.github.io/2025/09/14/databend-pivot-%E6%94%AF%E6%8C%81-subquery/","excerpt":"","text":"1 ä»»åŠ¡èƒŒæ™¯ Issueï¼šhttps://github.com/databendlabs/databend/issues/16556 PRï¼šhttps://github.com/databendlabs/databend/pull/16631 1.1 ä»»åŠ¡ä»‹ç» ç›®å‰ databend ä¸­çš„ pivot å’Œ unpivot ä¸æ”¯æŒ FROM/IN + subqueryã€‚â†’ æ–‡æ¡£é“¾æ¥ è¦æ±‚å®ç°ç±»ä¼¼äº snowflake çš„è¯­æ³•ï¼Œä¹Ÿå°±æ˜¯è®© pivot æ”¯æŒ FROM/IN + subqueryï¼Œunpivot æ”¯æŒ FROM + subqueryã€‚â†’ æ–‡æ¡£é“¾æ¥ databend PIVOT è¯­æ³• SELECT ...FROM ... PIVOT ( &lt;aggregate_function&gt; ( &lt;pivot_column&gt; ) FOR &lt;value_column&gt; IN ( &lt;pivot_value_1&gt; [ , &lt;pivot_value_2&gt; ... ] ) )[ ... ] &lt;aggregate_function&gt;ï¼šç”¨äºç»„åˆæ¥è‡ªpivot_columnçš„åˆ†ç»„å€¼çš„èšåˆå‡½æ•°ã€‚ &lt;pivot_column&gt;ï¼šå°†ä½¿ç”¨æŒ‡å®šçš„&lt;aggregate_function&gt;è¿›è¡Œèšåˆçš„åˆ—ã€‚ &lt;value_column&gt;ï¼šå…¶å”¯ä¸€å€¼å°†åœ¨æ—‹è½¬ç»“æœé›†ä¸­æˆä¸ºæ–°åˆ—çš„åˆ—ã€‚ &lt;pivot_value_N&gt;ï¼šæ¥è‡ª&lt;value_column&gt;çš„å”¯ä¸€å€¼ï¼Œå°†åœ¨æ—‹è½¬ç»“æœé›†ä¸­æˆä¸ºæ–°åˆ—ã€‚ databend UNPIVOT è¯­æ³• SELECT ...FROM ... UNPIVOT ( &lt;value_column&gt; FOR &lt;name_column&gt; IN ( &lt;column_list&gt; ) )[ ... ] &lt;value_column&gt;ï¼šå°†å­˜å‚¨ä» &lt;column_list&gt; ä¸­åˆ—å‡ºçš„åˆ—ä¸­æå–çš„å€¼çš„åˆ—ã€‚ &lt;name_column&gt;ï¼šå°†å­˜å‚¨ä»ä¸­æå–å€¼çš„åˆ—çš„åç§°çš„åˆ—ã€‚ &lt;column_list&gt;ï¼šè¦å–æ¶ˆé€è§†çš„åˆ—çš„åˆ—è¡¨ï¼Œç”¨é€—å·åˆ†éš”ã€‚ snowflake PIVOT è¯­æ³• 123456789101112SELECT ...FROM ... PIVOT ( &lt;aggregate_function&gt; ( &lt;pivot_column&gt; ) FOR &lt;value_column&gt; IN ( &lt;pivot_value_1&gt; [ , &lt;pivot_value_2&gt; ... ] | ANY [ ORDER BY ... ] | &lt;subquery&gt; ) [ DEFAULT ON NULL (&lt;value&gt;) ] )[ ... ] snowflake UNPIVOT è¯­æ³• SELECT ...FROM ... UNPIVOT [ &#123; INCLUDE | EXCLUDE &#125; NULLS ] ( &lt;value_column&gt; FOR &lt;name_column&gt; IN ( &lt;column_list&gt; ) )[ ... ] 1.2 ä»‹ç» pivot &amp; unpivot 1.2.1 pivotï¼ˆé€è§†ï¼Œä¸€åˆ—ä¸­çš„å±æ€§å€¼è½¬æˆå¤šä¸ªå¯¹åº”å±æ€§ï¼‰ https://docs.databend.com/sql/sql-commands/query-syntax/query-pivot PIVOTæ“ä½œé€šè¿‡æ—‹è½¬è¡¨æ ¼å¹¶åŸºäºæŒ‡å®šåˆ—èšåˆç»“æœæ¥è½¬æ¢è¡¨æ ¼ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯¹äºæ€»ç»“å’Œåˆ†æå¤§é‡æ•°æ®ä»¥æ›´å¯è¯»æ ¼å¼æ˜¾ç¤ºéå¸¸æœ‰ç”¨çš„æ“ä½œã€‚ databend PIVOT è¯­æ³• SELECT ...FROM ... PIVOT ( &lt;aggregate_function&gt; ( &lt;pivot_column&gt; ) FOR &lt;value_column&gt; IN ( &lt;pivot_value_1&gt; [ , &lt;pivot_value_2&gt; ... ] ) )[ ... ] &lt;aggregate_function&gt;ï¼šç”¨äºç»„åˆæ¥è‡ªpivot_columnçš„åˆ†ç»„å€¼çš„èšåˆå‡½æ•°ã€‚ &lt;pivot_column&gt;ï¼šå°†ä½¿ç”¨æŒ‡å®šçš„&lt;aggregate_function&gt;è¿›è¡Œèšåˆçš„åˆ—ã€‚ &lt;value_column&gt;ï¼šå…¶å”¯ä¸€å€¼å°†åœ¨æ—‹è½¬ç»“æœé›†ä¸­æˆä¸ºæ–°åˆ—çš„åˆ—ã€‚ &lt;pivot_value_N&gt;ï¼šæ¥è‡ª&lt;value_column&gt;çš„å”¯ä¸€å€¼ï¼Œå°†åœ¨æ—‹è½¬ç»“æœé›†ä¸­æˆä¸ºæ–°åˆ—ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º monthly_sales çš„è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸åŒå‘˜å·¥åœ¨ä¸åŒæœˆä»½çš„é”€å”®æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨PIVOTæ“ä½œæ¥æ€»ç»“æ•°æ®å¹¶è®¡ç®—æ¯ä¸ªå‘˜å·¥åœ¨æ¯ä¸ªæœˆçš„æ€»é”€å”®é¢ã€‚ åˆ›å»ºå’Œæ’å…¥æ•°æ® 12345678910111213141516171819202122232425-- åˆ›å»ºmonthly_salesè¡¨CREATE TABLE monthly_sales( empid INT, amount INT, month VARCHAR);-- æ’å…¥é”€å”®æ•°æ®INSERT INTO monthly_sales VALUES (1, 10000, &#x27;JAN&#x27;), (1, 400, &#x27;JAN&#x27;), (2, 4500, &#x27;JAN&#x27;), (2, 35000, &#x27;JAN&#x27;), (1, 5000, &#x27;FEB&#x27;), (1, 3000, &#x27;FEB&#x27;), (2, 200, &#x27;FEB&#x27;), (2, 90500, &#x27;FEB&#x27;), (1, 6000, &#x27;MAR&#x27;), (1, 5000, &#x27;MAR&#x27;), (2, 2500, &#x27;MAR&#x27;), (2, 9500, &#x27;MAR&#x27;), (1, 8000, &#x27;APR&#x27;), (1, 10000, &#x27;APR&#x27;), (2, 800, &#x27;APR&#x27;), (2, 4500, &#x27;APR&#x27;); ä½¿ç”¨ PIVOT ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨PIVOTæ“ä½œæ¥è®¡ç®—æ¯ä¸ªå‘˜å·¥åœ¨æ¯ä¸ªæœˆçš„æ€»é”€å”®é¢ã€‚æˆ‘ä»¬å°†ä½¿ç”¨SUMèšåˆå‡½æ•°æ¥è®¡ç®—æ€»é”€å”®é¢ï¼ŒMONTH åˆ—å°†è¢«æ—‹è½¬ä»¥ä¸ºæ¯ä¸ªæœˆåˆ›å»ºæ–°åˆ—ã€‚ SELECT *FROM monthly_salesPIVOT(SUM(amount) FOR MONTH IN (&#x27;JAN&#x27;, &#x27;FEB&#x27;, &#x27;MAR&#x27;, &#x27;APR&#x27;))ORDER BY EMPID; è¾“å‡ºï¼š +-------+-------+-------+-------+-------+| empid | jan | feb | mar | apr |+-------+-------+-------+-------+-------+| 1 | 10400 | 8000 | 11000 | 18000 || 2 | 39500 | 90700 | 12000 | 5300 |+-------+-------+-------+-------+-------+ 1.2.2 unpivotï¼ˆå–æ¶ˆé€è§†ï¼Œå¤šä¸ªå±æ€§è½¬æˆä¸€åˆ—ä¸­å¯¹åº”çš„å±æ€§å€¼ï¼‰ https://docs.databend.com/sql/sql-commands/query-syntax/query-unpivot UNPIVOT æ“ä½œé€šè¿‡å°†åˆ—è½¬æ¢ä¸ºè¡Œæ¥æ—‹è½¬è¡¨ã€‚å®ƒæ˜¯ä¸€ä¸ªå…³ç³»æ“ä½œç¬¦ï¼Œæ¥å—ä¸¤åˆ—ï¼ˆæ¥è‡ªè¡¨æˆ–å­æŸ¥è¯¢ï¼‰ï¼Œä»¥åŠåˆ—çš„åˆ—è¡¨ï¼Œå¹¶ä¸ºåˆ—è¡¨ä¸­æŒ‡å®šçš„æ¯åˆ—ç”Ÿæˆä¸€è¡Œã€‚åœ¨æŸ¥è¯¢ä¸­ï¼Œå®ƒåœ¨ FROM å­å¥ä¸­æŒ‡å®šï¼Œä½äºè¡¨åæˆ–å­æŸ¥è¯¢ä¹‹åã€‚ databend UNPIVOT è¯­æ³• SELECT ...FROM ... UNPIVOT ( &lt;value_column&gt; FOR &lt;name_column&gt; IN ( &lt;column_list&gt; ) )[ ... ] &lt;value_column&gt;ï¼šå°†å­˜å‚¨ä» &lt;column_list&gt; ä¸­åˆ—å‡ºçš„åˆ—ä¸­æå–çš„å€¼çš„åˆ—ã€‚ &lt;name_column&gt;ï¼šå°†å­˜å‚¨ä»ä¸­æå–å€¼çš„åˆ—çš„åç§°çš„åˆ—ã€‚ &lt;column_list&gt;ï¼šè¦å–æ¶ˆé€è§†çš„åˆ—çš„åˆ—è¡¨ï¼Œç”¨é€—å·åˆ†éš”ã€‚ è®©æˆ‘ä»¬å–æ¶ˆé€è§†ä¸ªåˆ«æœˆä»½åˆ—ï¼Œä»¥è¿”å›æ¯ä½å‘˜å·¥æ¯æœˆçš„å•ä¸€é”€å”®å€¼ï¼š åˆ›å»ºå’Œæ’å…¥æ•°æ® 12345678910111213-- åˆ›å»º unpivoted_monthly_sales è¡¨CREATE TABLE unpivoted_monthly_sales( empid INT, jan INT, feb INT, mar INT, apr INT);-- æ’å…¥é”€å”®æ•°æ®INSERT INTO unpivoted_monthly_sales VALUES (1, 10400, 8000, 11000, 18000), (2, 39500, 90700, 12000, 5300); ä½¿ç”¨ UNPIVOT SELECT *FROM unpivoted_monthly_sales UNPIVOT (amount FOR month IN (jan, feb, mar, apr)); è¾“å‡ºï¼š 123456789101112+-------+-------+--------+| empid | month | amount |+-------+-------+--------+| 1 | jan | 10400 || 1 | feb | 8000 || 1 | mar | 11000 || 1 | apr | 18000 || 2 | jan | 39500 || 2 | feb | 90700 || 2 | mar | 12000 || 2 | apr | 5300 |+-------+-------+--------+ 2 è®¾è®¡å‚è€ƒï¼ˆç«å“åˆ†æï¼‰ 3 æ€è·¯ä¸å®ç° 3.1 æ€è·¯ å®ç° from + subquery è¾ƒä¸ºç®€å•ï¼Œåœ¨ TableReference::Subquery åŠ ä¸Š pivot å’Œ unpivot å­—æ®µï¼Œä¿®æ”¹ parser åŠå…¶ä»–ç›¸å…³åœ°æ–¹ã€‚ 123456789101112let subquery = map( rule! &#123; LATERAL? ~ &quot;(&quot; ~ #query ~ &quot;)&quot; ~ #table_alias? ~ #pivot? ~ #unpivot? &#125;, |(lateral, _, subquery, _, alias, pivot, unpivot)| TableReferenceElement::Subquery &#123; lateral: lateral.is_some(), subquery: Box::new(subquery), alias, pivot: pivot.map(Box::new), unpivot: unpivot.map(Box::new), &#125;,); å®ç° in + subquery ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºåœ¨ binder çš„æ—¶å€™å¿…é¡»çŸ¥é“ column çš„ name æ‰èƒ½ç”Ÿæˆé€»è¾‘è®¡åˆ’ï¼Œæ‰€ä»¥åªèƒ½å…ˆæ‰§è¡Œä¸€ä¸‹è¿™ä¸ª subquery ï¼Œç„¶åæŠŠè¿”å›å€¼å½“ä½œ values å¤„ç†ï¼›ä½†æ˜¯æ‰§è¡Œ query/plan æ˜¯åœ¨ service æ¨¡å—ä¸‹ï¼Œbinder æ˜¯åœ¨ sql æ¨¡å—ï¼Œå­˜åœ¨å¾ªç¯è°ƒç”¨çš„é—®é¢˜ã€‚â†’ è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ è§£å†³æ€è·¯æœ‰ä¸‰ç§ï¼š ã€æ€è·¯-1ã€‘åœ¨ pivot_rewrite é˜¶æ®µï¼ˆbinderï¼‰æ‰§è¡Œ Subquery å¾—åˆ°ç­”æ¡ˆï¼Œå‚è€ƒ QuerySampleExecutor å†™ä¸ªå›è°ƒå‡½æ•°åœ¨ binder é‡Œé¢è°ƒä¸€ä¸‹ service çš„å‡½æ•°æ‰§è¡Œã€‚ Pivot ç»“æ„ä½“æ–°æ·» Subquery å­—æ®µï¼ˆQueryï¼‰ï¼Œç”¨äºå­˜å‚¨ in + subquery ä¸­çš„ subqueryï¼› Pivot 123456789101112131415161718// åŸç‰ˆpub struct Pivot &#123; pub aggregate: Expr, pub value_column: Identifier, pub values: Vec&lt;Expr&gt;,&#125;// ä¿®æ”¹åpub enum PivotValues &#123; ColumnValues(Vec&lt;Expr&gt;), Subquery(Box&lt;Query&gt;),&#125;pub struct Pivot &#123; pub aggregate: Expr, pub value_column: Identifier, pub values: PivotValues,&#125; åœ¨ rewrite_pivot å‡½æ•°ä¸­å¯¹ Subquery è¿›è¡Œ parser + rewrite + opt + exec ç­‰æ“ä½œï¼Œå¹¶å°†ç»“æœå­˜åœ¨åŸæ¥çš„ values å­—æ®µï¼Œåç»­æ“ä½œä¸€è‡´ã€‚ æ‰§è¡Œ query çš„å›è°ƒå‡½æ•°ç›®å‰æœ‰åŸºäº PhysicalPlan çš„ï¼Œä¸€ç§æ–¹æ¡ˆæ˜¯åŸºäºè¯¥å‡½æ•°è¿›è¡Œæ“ä½œï¼›å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æ–°æ·»åŸºäº Query String æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚ ã€æ€è·¯-2ã€‘åœ¨å‘ç° subquery çš„æ—¶å€™è¿”å›ï¼Œåœ¨ service é‡Œé¢æ‰§è¡Œä¹‹åé‡å†™ sqlï¼Œç„¶åå†æ¬¡æ‰§è¡Œã€‚ ã€æ€è·¯-3ã€‘ç°åœ¨çš„ plan_sql å‡½æ•°é‡Œé¢ä¼šæ‰§è¡Œ parser å¹¶ç”Ÿæˆ planï¼Œå¯ä»¥æŠŠè¿™ä¸ªå‡½æ•°æ‹†æˆä¸¤ä¸ªï¼š ç¬¬ä¸€ä¸ªå‡½æ•°æ‰§è¡Œ parserï¼Œç”Ÿæˆ stmtï¼ŒåŒæ—¶è¿›è¡Œä¸€äº› rewriteï¼Œå¦‚æœè¿™æ—¶å‘ç°æœ‰ subquery çš„è¯ï¼Œå°±å…ˆæ‰§è¡Œä¸€ä¸‹ï¼Œç„¶å rewriteã€‚ ç¬¬äºŒä¸ªå‡½æ•°ä¼ å…¥ rewrite ä¹‹åçš„ stmtï¼Œç”Ÿæˆ planã€‚ æœ¬ç€å°½å¯èƒ½å°‘çš„æ”¹åŠ¨å½“å‰ä»£ç ç»“æ„çš„åŸåˆ™ï¼Œé€‰æ‹©**ã€æ€è·¯-1ã€‘**è¿›è¡Œå®ç°ã€‚ 3.2 review ç›¸å…³ä¿®æ”¹ ã€review-1ã€‘é¿å…ä¸å¿…è¦çš„ clone 123456789101112131415161718192021// åŸç‰ˆlet value = columns[0].to_column(block.num_rows()); // ä¿®æ”¹for row in 0..block.num_rows() &#123; match columns[0].value.index(row).unwrap() &#123; ScalarRef::String(s) =&gt; &#123; let literal = Expr::Literal &#123; span, value: Literal::String(s.to_string()), &#125;; values.push(literal); &#125; _ =&gt; &#123; return Err(ErrorCode::SemanticError( &quot;The subquery of `pivot in` must return a string type&quot;, ) .set_span(span)); &#125; &#125;&#125; ã€review-2ã€‘é’ˆå¯¹äº subquery è¿”å›çš„æ¯ä¸ª String ä¸éœ€è¦è®¾ç½® spanï¼Œä½¿ç”¨ subquery çš„ span å³å¯ã€‚ ã€review-3ã€‘ä½¿ç”¨ block.num_columns() è®¡ç®— column çš„æ•°é‡ã€‚ // åŸç‰ˆlet columns = block.columns();if columns.len() != 1 &#123; // ...&#125;// ä¿®æ”¹åif block.num_columns() != 1 &#123; // ...&#125; ã€review-4ã€‘å°† sample_executor å’Œ subquery_executor åˆå¹¶æˆä¸€ä¸ª query_executorï¼Œå®ç°ä¸åŒçš„å‡½æ•°ç”¨æ¥åšåŒºåˆ†ã€‚ ã€review-5ã€‘å¯¹è¿”å›çš„ ErrorCode è®¾ç½® spanã€‚â†’ span ä¸ä½¿ç”¨ spanï¼š return Err(ErrorCode::SemanticError( &quot;The subquery of `pivot in` must return one column&quot;,)); MySQL [dev]&gt; SELECT * FROM (select * from monthly_sales) PIVOT(SUM(amount) FOR MONTH IN (select distinct month, month from monthly_sales)) ORDER BY EMPID;ERROR 1105 (HY000): SemanticError. Code: 1065, Text = The subquery of `pivot in` must return one column. ä½¿ç”¨ spanï¼š return Err(ErrorCode::SemanticError( &quot;The subquery of `pivot in` must return one column&quot;,).set_span(span)); MySQL [dev]&gt; SELECT * FROM (select * from monthly_sales) PIVOT(SUM(amount) FOR MONTH IN (select distinct empid from monthly_sales)) ORDER BY EMPID;ERROR 1105 (HY000): SemanticError. Code: 1065, Text = error: --&gt; SQL:1:78 |1 | SELECT * FROM (select * from monthly_sales) PIVOT(SUM(amount) FOR MONTH IN (select distinct empid from monthly_sales)) ORDER BY EMPID | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ The subquery of `pivot in` must return a string type. 3.3 bugs ã€bug-1ã€‘å› ä¸ºéœ€è¦ä¸¤æ¬¡ç”¨åˆ° pivot å˜é‡ï¼Œæ‰€ä»¥ä¼šæŠ¥ error: use of moved value çš„é”™è¯¯ã€‚â†’ error: use of moved value æŠŠ pivot å’Œ unpivot æŒªå‡ºå»ï¼Œæ”¹æˆä¸¤ä¸ªå•ç‹¬çš„å‡½æ•°ã€‚ ã€bug-2ã€‘rewrite_pivot æ˜¯é async å‡½æ•°ï¼Œä½†æ˜¯ subquery_executor.execute_query_with_sql_string æ˜¯ async å‡½æ•°ï¼Œrewrite_pivot ä¸­éœ€è¦è°ƒç”¨ subquery_executor.execute_query_with_sql_stringã€‚æ‰€ä»¥ä¼šæŠ¥é”™ï¼šawait is only allowed inside async functions and blocksã€‚â†’ åœ¨é async å‡½æ•°é‡Œè°ƒç”¨ async å‡½æ•° databend_common_base::runtime::block_on 4 æµ‹è¯• 4.1 åŠŸèƒ½æµ‹è¯• ä¸ snowflake è¯­æ³•ä¿æŒä¸€è‡´ï¼š pivot æ”¯æŒä¸‰ç§ subqueryï¼Œfrom + subqueryã€in + subqueryã€from + subquery + in + subqueryã€‚ unpivot åªæ”¯æŒ from + subquery ä¸€ç§ã€‚ 4.1.1 æ‰‹åŠ¨æµ‹è¯• æµ‹è¯• Pivot Create the monthly_sales table CREATE TABLE monthly_sales( empid INT, amount INT, month VARCHAR); Insert sales data 1234567891011121314151617INSERT INTO monthly_sales VALUES (1, 10000, &#x27;JAN&#x27;), (1, 400, &#x27;JAN&#x27;), (2, 4500, &#x27;JAN&#x27;), (2, 35000, &#x27;JAN&#x27;), (1, 5000, &#x27;FEB&#x27;), (1, 3000, &#x27;FEB&#x27;), (2, 200, &#x27;FEB&#x27;), (2, 90500, &#x27;FEB&#x27;), (1, 6000, &#x27;MAR&#x27;), (1, 5000, &#x27;MAR&#x27;), (2, 2500, &#x27;MAR&#x27;), (2, 9500, &#x27;MAR&#x27;), (1, 8000, &#x27;APR&#x27;), (1, 10000, &#x27;APR&#x27;), (2, 800, &#x27;APR&#x27;), (2, 4500, &#x27;APR&#x27;); Pivotï¼ˆåŸç‰ˆï¼‰ SELECT * FROM monthly_salesPIVOT(SUM(amount) FOR MONTH IN (&#x27;JAN&#x27;, &#x27;FEB&#x27;, &#x27;MAR&#x27;, &#x27;APR&#x27;))ORDER BY EMPID; from + subquery SELECT *FROM (select * from monthly_sales)PIVOT(SUM(amount) FOR MONTH IN (&#x27;JAN&#x27;, &#x27;FEB&#x27;, &#x27;MAR&#x27;, &#x27;APR&#x27;))ORDER BY EMPID; in + subquery SELECT * FROM monthly_salesPIVOT(SUM(amount) FOR MONTH IN (select distinct month from monthly_sales))ORDER BY EMPID; from + in + subquery SELECT * FROM (select * from monthly_sales)PIVOT(SUM(amount) FOR MONTH IN (select distinct month from monthly_sales))ORDER BY EMPID; Answer +-------+-------+-------+-------+-------+| empid | jan | feb | mar | apr |+-------+-------+-------+-------+-------+| 1 | 10400 | 8000 | 11000 | 18000 || 2 | 39500 | 90700 | 12000 | 5300 |+-------+-------+-------+-------+-------+ æµ‹è¯• Unpivot Create the unpivoted_monthly_sales table CREATE TABLE unpivoted_monthly_sales( empid INT, jan INT, feb INT, mar INT, apr INT); Insert sales data INSERT INTO unpivoted_monthly_sales VALUES (1, 10400, 8000, 11000, 18000), (2, 39500, 90700, 12000, 5300); unpivotï¼ˆåŸç‰ˆï¼‰ SELECT *FROM unpivoted_monthly_sales UNPIVOT (amount FOR month IN (jan, feb, mar, apr)); from + subquery SELECT * FROM (SELECT * FROM monthly_sales_1) UNPIVOT(sales FOR month IN (jan, feb, mar, april)) ORDER BY empid Answer 123456789101112+-------+-------+--------+| empid | month | amount |+-------+-------+--------+| 1 | jan | 10400 || 1 | feb | 8000 || 1 | mar | 11000 || 1 | apr | 18000 || 2 | jan | 39500 || 2 | feb | 90700 || 2 | mar | 12000 || 2 | apr | 5300 |+-------+-------+--------+ 4.1.2 å•å…ƒæµ‹è¯•ï¼ˆast ç›¸å…³ï¼‰ make unit-test parser æ”¹äº†ä¼šå¯¼è‡´ä¹‹å‰çš„æµ‹è¯•å¤±è´¥ï¼Œä¿®å¤ä¸‹é¢ä¸¤ä¸ªæ–‡ä»¶ï¼š src/query/ast/tests/it/testdata/stmt.txt src/query/ast/tests/it/testdata/query.txt å¦å¤–åœ¨ test_query å‡½æ•°åŠ ä¸Šä¸€ä¸ª pivot &amp; unpivot å¸¦ subquery çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç›¸å…³æ–‡ä»¶ï¼šsrc/query/ast/tests/it/parser.rsã€‚ 4.1.3 é€»è¾‘æµ‹è¯•ï¼ˆsql æ‰§è¡Œç»“æœï¼‰ make sqllogic-test ä¸ºäº†åŠ å¿«æµ‹è¯•é€Ÿåº¦ï¼Œå¯ä»¥æŒ‡å®šç›®å½•è¿›è¡Œæ‰§è¡Œï¼Œç”šè‡³å¯ä»¥ä¿®æ”¹æ–‡ä»¶åä½¿å…¶åœ¨å½“å‰ç›®å½•å…ˆæ‰§è¡Œï¼š ./target/debug/databend-sqllogictests --handlers mysql --run_dir query æ·»åŠ  pivot &amp; unpivot ç›¸å…³ sql æŸ¥è¯¢ï¼Œç›¸å…³æ–‡ä»¶ï¼š tests/sqllogictests/suites/query/pivot.test tests/sqllogictests/suites/query/unpivot.test 4.2 æ€§èƒ½æµ‹è¯• 5 éš¾ç‚¹ 6 TODO X å‚è€ƒ https://docs.snowflake.com/en/sql-reference/constructs/pivot https://docs.snowflake.com/en/sql-reference/constructs/unpivot https://docs.databend.com/sql/sql-commands/query-syntax/query-pivot https://docs.databend.com/sql/sql-commands/query-syntax/query-unpivot","categories":[{"name":"DB","slug":"DB","permalink":"https://dragonliu2018.github.io/categories/DB/"},{"name":"databend","slug":"DB/databend","permalink":"https://dragonliu2018.github.io/categories/DB/databend/"},{"name":"å‡½æ•°/è¡¨è¾¾å¼","slug":"DB/å‡½æ•°-è¡¨è¾¾å¼","permalink":"https://dragonliu2018.github.io/categories/DB/%E5%87%BD%E6%95%B0-%E8%A1%A8%E8%BE%BE%E5%BC%8F/"}],"tags":[{"name":"pr","slug":"pr","permalink":"https://dragonliu2018.github.io/tags/pr/"}]},{"title":"[doris][Status] Implement format methods for Status","slug":"doris-Status-Implement-format-methods-for-Status","date":"2025-09-14T09:26:44.000Z","updated":"2025-09-23T01:05:52.936Z","comments":true,"path":"2025/09/14/doris-Status-Implement-format-methods-for-Status/","permalink":"https://dragonliu2018.github.io/2025/09/14/doris-Status-Implement-format-methods-for-Status/","excerpt":"","text":"1 issue ä»‹ç» å½“å‰ Status ç±»å‹è¿›è¡Œ format æ—¶ï¼Œéœ€è¦è°ƒç”¨ to_string å‡½æ•°ï¼š fmt::format(&quot;&#123;&#125;&quot;, status.to_string()); æƒ³è¦çš„æ•ˆæœæ˜¯åªéœ€è¦ä¼ å…¥ Status ç±»å‹å³å¯ï¼š fmt::format(&quot;&#123;&#125;&quot;, status); 2 å®ç° 2.1 è§£æ fmt åº“æä¾›äº†ä¸€ä¸ªç±»æ¨¡æ¿ fmt::formatterï¼Œé€šè¿‡æ¨¡æ¿ç‰¹åŒ–ä¸º Status ç±»å‹æä¾›é€‚å½“çš„æ ¼å¼åŒ–æ–¹å¼ã€‚ ç„¶åå®ç° parse å’Œ format å‡½æ•°å³å¯ï¼š parse å‡½æ•°è´Ÿè´£è§£ææ ¼å¼å­—ç¬¦ä¸²ã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½ä¸éœ€è¦æä¾›è‡ªå·±çš„ parse å‡½æ•°ï¼Œè€Œå¯ä»¥ä½¿ç”¨ fmt é»˜è®¤æä¾›çš„ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬ç®€å•åœ°è¿”å›è§£æä¸Šä¸‹æ–‡çš„å¼€å§‹è¿­ä»£å™¨ã€‚ format å‡½æ•°æ˜¯ç”¨æˆ·å¿…é¡»æä¾›çš„å…³é”®æˆå‘˜å‡½æ•°ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•å°†è‡ªå®šä¹‰ç±»å‹æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚ 2.2 åŠŸèƒ½ä»£ç  ğŸ‘‰ **å‚è€ƒï¼š**https://wgml.pl/blog/formatting-user-defined-types-fmt.html 12345678910111213// specify formatter for Statustemplate &lt;&gt;struct fmt::formatter&lt;doris::Status&gt; &#123; template &lt;typename ParseContext&gt; constexpr auto parse(ParseContext&amp; ctx) &#123; return ctx.begin(); &#125; template &lt;typename FormatContext&gt; auto format(doris::Status const&amp; status, FormatContext&amp; ctx) &#123; return fmt::format_to(ctx.out(), &quot;&#123;&#125;&quot;, status.to_string()); &#125;&#125;; 2.3 æµ‹è¯•ä»£ç  å®ç°å®Œæˆåï¼Œç¼–å†™æµ‹è¯•æ ·ä¾‹ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„è¦†ç›–ç‡ã€‚ reviewer æå‡ºçš„å»ºè®®æ˜¯ï¼š please add 3 testsï¼š1. status == ok2. status == error &amp;&amp; has stacktrace3. status == error &amp;&amp; do not have stacktrace 3 é—®é¢˜ 3.1 ld: symbol(s) not found for architecture x86_64 åœ¨æœ¬åœ° macos ä¸Šå°è¯•å†™äº†ä¸ªæµ‹è¯•ç¨‹åºï¼Œä½†æ˜¯å‘ç”Ÿä¸‹é¢çš„æŠ¥é”™ï¼š âœ test-reset git:(main) âœ— g++ test.cpp -std=c++20 -o testUndefined symbols for architecture x86_64: &quot;void fmt::v10::detail::vformat_to&lt;char&gt;(fmt::v10::detail::buffer&lt;char&gt;&amp;, fmt::v10::basic_string_view&lt;char&gt;, fmt::v10::detail::vformat_args&lt;char&gt;::type, fmt::v10::detail::locale_ref)&quot;, referenced from: fmt::v10::appender fmt::v10::vformat_to&lt;fmt::v10::appender, 0&gt;(fmt::v10::appender, fmt::v10::basic_string_view&lt;char&gt;, fmt::v10::basic_format_args&lt;fmt::v10::basic_format_context&lt;fmt::v10::appender, char&gt; &gt;) in test-878b3f.o &quot;fmt::v10::detail::assert_fail(char const*, int, char const*)&quot;, referenced from: std::__1::make_unsigned&lt;long&gt;::type fmt::v10::detail::to_unsigned&lt;long&gt;(long) in test-878b3f.o &quot;fmt::v10::vprint(fmt::v10::basic_string_view&lt;char&gt;, fmt::v10::basic_format_args&lt;fmt::v10::basic_format_context&lt;fmt::v10::appender, char&gt; &gt;)&quot;, referenced from: _main in test-878b3f.old: symbol(s) not found for architecture x86_64clang: error: linker command failed with exit code 1 (use -v to see invocation) è§£å†³ï¼šåŸå› æ˜¯æœªé“¾æ¥ fmt åº“æ–‡ä»¶ g++ test.cpp -std=c++20 -o test -lfmt å‚è€ƒï¼šhttps://stackoverflow.com/questions/56608684/how-to-use-the-fmt-library-without-getting-undefined-symbols-for-architecture-x 3.2 fmt::formatter æ¨¡æ¿ç‰¹åŒ–ä»£ç ä¸èƒ½åœ¨ doris çš„ namespace å¼€å§‹å°†ç‰¹åŒ–ä»£ç æ”¾åœ¨äº† doris namespace ä¸­ï¼Œå‘ç”Ÿäº†ä¸‹é¢çš„æŠ¥é”™ï¼š Class template specialization of &#x27;formatter&#x27; not in a namespace enclosing &#x27;v8&#x27; is a Microsoft extension clang(-Wmicrosoft-template)[core.h(707, 8): ] Explicitly specialized declaration is here è§£å†³ï¼š namespace doris &#123;// doris code&#125; // end doris_namespace// define formatter here **å‚è€ƒï¼š**https://github.com/fmtlib/fmt/issues/2767","categories":[{"name":"DB","slug":"DB","permalink":"https://dragonliu2018.github.io/categories/DB/"},{"name":"doris","slug":"DB/doris","permalink":"https://dragonliu2018.github.io/categories/DB/doris/"}],"tags":[{"name":"pr","slug":"pr","permalink":"https://dragonliu2018.github.io/tags/pr/"}]},{"title":"[Tool] Hexo ä½¿ç”¨æ•™ç¨‹","slug":"Tool-Hexo-ä½¿ç”¨æ•™ç¨‹","date":"2025-09-13T15:37:08.000Z","updated":"2025-09-23T01:03:51.746Z","comments":true,"path":"2025/09/13/Tool-Hexo-ä½¿ç”¨æ•™ç¨‹/","permalink":"https://dragonliu2018.github.io/2025/09/13/Tool-Hexo-%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/","excerpt":"","text":"ç¯å¢ƒå‡†å¤‡ âœ nvm --version0.39.1âœ node -vv24.8.0âœ npm -v11.6.0# å®‰è£… Hexonpm install -g hexo-cli æœ¬åœ°è¿è¡Œ Hexo åˆå§‹åŒ– hexoï¼Œç”Ÿæˆ hexo-blog ç›®å½• hexo init hexo-blog è¿›å…¥ hexo-blog ç›®å½•ï¼Œä¸‹è½½ pure ä¸»é¢˜å’Œ source æ–‡ç«  cd hexo-bloggit clone https://github.com/Dragonliu2018/hexo-theme-pure.git themes/pure# åˆ é™¤é»˜è®¤ç”Ÿæˆçš„ _posts ç›®å½•rm -rf source/_postsgit clone https://github.com/Dragonliu2018/hexo-source.git source é…ç½® pureï¼Œref link npm install hexo-wordcount --savenpm install hexo-generator-json-content --savenpm install hexo-generator-feed --savenpm install hexo-generator-sitemap --savenpm install hexo-generator-baidu-sitemap --savenpm install hexo-neat --savenpm install hexo-translate-title --savenpm un hexo-renderer-marked --savenpm i hexo-renderer-markdown-it-plus --savenpm install hexo-deployer-git --save ä¿®æ”¹ _config.yml 1234567891011121314151617# é¡µé¢ä¸­åˆ†ç±»ç­‰å¯¼èˆªè¯çš„è¯­è¨€- language: en+ language: zh-CN# æœç´¢ç•Œé¢çš„åˆ†ç±»éƒ¨åˆ†æ‹¼æ¥ url- url: http://example.com+ url: https://dragonliu2018.github.io# è®¾ç½®ä¸»é¢˜- theme: landscape+ theme: pure# è®¾ç½®éƒ¨ç½²deploy: type: git repo: https://github.com/dragonliu2018/dragonliu2018.github.io.git branch: master è¿è¡Œ hexo hexo ghexo s éƒ¨ç½² Github å‚è€ƒï¼šhttps://hexo.io/docs/one-command-deployment å®‰è£… hexo-deployer-git npm install hexo-deployer-git --save ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½• blog ä¸‹çš„ _config.yml deploy: type: git repo: https://github.com/dragonliu2018/dragonliu2018.github.io.git branch: master éƒ¨ç½² hexo g å¸¸ç”¨å‘½ä»¤ hexo cleanhexo ghexo shexo d","categories":[{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"Hexo","slug":"Tool/Hexo","permalink":"https://dragonliu2018.github.io/categories/Tool/Hexo/"}],"tags":[]}],"categories":[{"name":"DB","slug":"DB","permalink":"https://dragonliu2018.github.io/categories/DB/"},{"name":"doris","slug":"DB/doris","permalink":"https://dragonliu2018.github.io/categories/DB/doris/"},{"name":"Tool","slug":"Tool","permalink":"https://dragonliu2018.github.io/categories/Tool/"},{"name":"opt","slug":"Tool/opt","permalink":"https://dragonliu2018.github.io/categories/Tool/opt/"},{"name":"PL","slug":"PL","permalink":"https://dragonliu2018.github.io/categories/PL/"},{"name":"C++","slug":"PL/C","permalink":"https://dragonliu2018.github.io/categories/PL/C/"},{"name":"docker","slug":"Tool/docker","permalink":"https://dragonliu2018.github.io/categories/Tool/docker/"},{"name":"Python","slug":"PL/Python","permalink":"https://dragonliu2018.github.io/categories/PL/Python/"},{"name":"git","slug":"Tool/git","permalink":"https://dragonliu2018.github.io/categories/Tool/git/"},{"name":"wsl","slug":"Tool/wsl","permalink":"https://dragonliu2018.github.io/categories/Tool/wsl/"},{"name":"databend","slug":"DB/databend","permalink":"https://dragonliu2018.github.io/categories/DB/databend/"},{"name":"å‡½æ•°/è¡¨è¾¾å¼","slug":"DB/å‡½æ•°-è¡¨è¾¾å¼","permalink":"https://dragonliu2018.github.io/categories/DB/%E5%87%BD%E6%95%B0-%E8%A1%A8%E8%BE%BE%E5%BC%8F/"},{"name":"Hexo","slug":"Tool/Hexo","permalink":"https://dragonliu2018.github.io/categories/Tool/Hexo/"}],"tags":[{"name":"pr","slug":"pr","permalink":"https://dragonliu2018.github.io/tags/pr/"}]}